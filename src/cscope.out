cscope 15 $HOME/Projects/Linux/linux-adk/src -q 0000000397 0000047622
	@/home/bravo/Projects/Linux/linux-adk/src/accessory.c

21 
	~<¡dio.h
>

22 
	~<¡ršg.h
>

23 
	~<¡dlib.h
>

24 
	~<uni¡d.h
>

25 
	~<¡ršg.h
>

27 
	~<libusb.h
>

29 
	~"lšux-adk.h
"

30 
	~"hid.h
"

32 
	gv®id_mou£_»pÜt_desütÜ
 [] =

89 
	$acûssÜy_maš
(
acûssÜy_t
 * 
acc
)

93 
»t
 = 0;

94 
hid_deviû_t
 
hid
;

113 if(
	`£¬ch_hid
(&
hid
) == 0) {

115 
	`£nd_hid_desütÜ
(
acc
, &
hid
);

121 if(
	`£¬ch_hid
(&
hid
) == 0) {

122 
	`»gi¡”_hid_ÿÎback
(
acc
, &
hid
);

124 
	`£t_hid_logiÿl_¿nge
(1080,1920);

125 
	`£t_hid_physiÿl_¿nge
(0,0);

126 
	`£nd_hid_desütÜ
(
acc
, &
hid
);

131 ià((
acc
->
pid
 !ğ
AOA_AUDIO_ADB_PID
è&& (acc->pid !ğ
AOA_AUDIO_PID
)) {

132 
ušt8_t
 
acc_buf
[512];

133 
Œªsã¼ed
, 
i
;

134 
”rÜs
 = 20;

136 
	`´štf
("detach..\n");

137 
	`libusb_£t_auto_d‘ach_k”Ãl_driv”
(
acc
->
hªdË
,1);

140 
	`u¦“p
(10000);

141 
	`´štf
("claiming ...\n");

145 
»t
 =

146 
	`libusb_şaim_š‹rçû
(
acc
->
hªdË
,

147 
AOA_ACCESSORY_INTERFACE
);

148 ià(
»t
 != 0) {

149 
	`´štf
("E¼Ü %d cÏimšg iÁ”çû...\n", 
»t
);

153 
	`´štf
("Snooping†oop\n");

155 
t
 = 0;

157 !
¡İ_acc
) {

158 
	`mem£t
(
acc_buf
,++
t
 % 512,(acc_buf));

160 
»t
 =

161 
	`libusb_bulk_Œªsãr
(
acc
->
hªdË
,

162 
AOA_ACCESSORY_EP_OUT
, 
acc_buf
,

163 (
acc_buf
), &
Œªsã¼ed
,

165 
	`´štf
("EP_OUT„‘(%d)\n",
»t
);

167 
»t
 =

168 
	`libusb_bulk_Œªsãr
(
acc
->
hªdË
,

170 
AOA_ACCESSORY_EP_IN
, 
acc_buf
,

171 (
acc_buf
), &
Œªsã¼ed
,

174 ià(
»t
 < 0) {

175 ià(
»t
 =ğ
LIBUSB_ERROR_TIMEOUT
) {

176 
	`´štf
("timeout...\n");

179 
	`´štf
("bulk¿nsã¸”rÜ %d\n", 
»t
);

180 ià(--
”rÜs
 == 0)

183 
	`¦“p
(1);

188 
	`´štf
("Reûived %d by‹s\n", 
Œªsã¼ed
);

189 
i
 = 0; i < 
Œªsã¼ed
;) {

190 
	`´štf
("%#2.2x ", 
acc_buf
[
i
++]);

191 ià(!(
i
 % 8))

192 
	`´štf
("\n");

194 
	`´štf
("\n");

199 ià((
acc
->
pid
 >ğ
AOA_AUDIO_PID
è&& (
hid
.
hªdË
))

200 
	`±h»ad_još
(
hid
.
rx_th»ad
, 
NULL
);

201 
	}
}

	@/home/bravo/Projects/Linux/linux-adk/src/axis.c

8 
	~<¡dio.h
>

9 
	~<m©h.h
>

10 
	~<lšux/šput.h
>

11 
	~"axis.h
"

13 
AxisS‘tšg
* 
	g£tup
;

14 
	grÙ
;

15 
	gcos_v®
 = -1;

16 
	gsš_v®
 = -1;

23 
	$axis_š™
(
AxisS‘tšg
* 
as
 , 
ªgË
)

25 if(
as
 =ğ
NULL
 && (
ªgË
 % 90)!= 0) {

28 
£tup
 = 
as
;

29 
rÙ
 = 
ªgË
;

30 
sš_v®
 = 
	`sš
(()(2* 
PI
 * 
ªgË
 / 360));

31 
cos_v®
 = 
	`cos
(()(2* 
PI
 * 
ªgË
 / 360));

44 
	}
}

47 
Pošt
 
	$axis_cÚv”t
(
Pošt
 
p
)

49 
Pošt
 
»t
;

50 
x
,
y
;

52 if((
p
.
x
 - 
£tup
->
css
.
ba£_x
 ) > s‘up->css.
v›w_width
)

53 
p
.
x
 = 
£tup
->
css
.
v›w_width
;

54 if((
p
.
y
 - 
£tup
->
css
.
ba£_y
 ) > s‘up->css.
v›w_height
)

55 
p
.
y
 = 
£tup
->
css
.
v›w_height
;

58 
x
 = 
cos_v®
 * 
p
.x + 
sš_v®
 *….
y
;

59 
y
 = 
cos_v®
 * 
p
.y - 
sš_v®
 *….
x
;

63 
rÙ
) {

66 
y
 = y - 
£tup
->
css
.
ba£_x
 + s‘up->css.
fuÎ_width
;

67 
x
 = x - 
£tup
->
css
.
ba£_y
;

69 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_height
;

70 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_width
;

74 
x
 = x - 
£tup
->
css
.
ba£_y
 + s‘up->css.
fuÎ_height
;

75 
y
 = y - 
£tup
->
css
.
ba£_x
;

77 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_height
;

78 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_width
;

82 
x
 = x - 
£tup
->
css
.
ba£_x
 + s‘up->css.
fuÎ_width
;

83 
y
 = y - 
£tup
->
css
.
ba£_y
 + s‘up->css.
fuÎ_height
;

85 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_width
;

86 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_height
;

90 
x
 = x - 
£tup
->
css
.
ba£_x
;

91 
y
 = y - 
£tup
->
css
.
ba£_y
;

93 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_width
;

94 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_height
;

97 
	`´štf
("unsupported„ot\n");

101 
»t
.
x
 = ()x;

102 
»t
.
y
 = ()y;

103  
»t
;

104 
	}
}

106 
Pošt
 
	$axis_cÚv”t
(
Pošt
 
p
)

108 
Pošt
 
»t
;

109 
»t
.
x
 = -1;

110 
»t
.
y
 = -1;

111 
x1
,
y1
;

112 
x
,
y
;

114 if((
p
.
x
 - 
£tup
->
css
.
ba£_x
 ) > s‘up->css.
v›w_width
)

115  
»t
;

116 if((
p
.
y
 - 
£tup
->
css
.
ba£_y
 ) > s‘up->css.
v›w_height
)

117  
»t
;

120 
x
 = 
p
.x - 
£tup
->
css
.
ba£_x
;

121 
y
 = 
p
.y - 
£tup
->
css
.
ba£_y
;

125 
x1
 = ()(
cos_v®
 * 
x
 + 
sš_v®
 * 
y
);

126 
y1
 = ()(
cos_v®
 * 
y
 - 
sš_v®
 * 
x
);

128 
x
 = 
x1
;

129 
y
 = 
y1
;

132 
rÙ
){

135 
y
 = y + 
£tup
->
css
.
v›w_width
;

136 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_height
;

137 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_width
;

141 
x
 = x + 
£tup
->
css
.
v›w_height
;

142 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_height
;

143 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_width
;

147 
x
 = x + 
£tup
->
css
.
v›w_width
;

148 
y
 = y + 
£tup
->
css
.
v›w_height
;

149 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_width
;

150 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_height
;

154 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_width
;

155 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_height
;

158 
	`´štf
("not supported„ot\n");

162 
»t
.
x
 = ()x;

163 
»t
.
y
 = ()y;

166  
»t
;

167 
	}
}

176 
wr™e_ev’t
(
fd
, 
ty³
, 
code
, 
v®ue
);

177 
EVENT_INFO
 
ei
;

179 
	$axis_šjeù
(
aùiÚ
, 
Pošt
 
p
)

181 
x
 = 
p
.x;

182 
y
 = 
p
.y;

183 
aùiÚ
) {

184 
TOUCH_DOWN
:

196 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_TRACKING_ID
, 0x1b3a);

197 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_KEY
,
BTN_TOUCH
,1);

198 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_ABS
,
ABS_MT_POSITION_X
,
x
);

199 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_ABS
,
ABS_MT_POSITION_Y
,
y
);

200 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_ABS
,
ABS_MT_PRESSURE
,0x3e);

201 
	`wr™e_ev’t
(
ei
.
fd_touch
,0,0,0);

208 
TOUCH_UP
:

213 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_TRACKING_ID
, -1);

214 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_KEY
, 
BTN_TOUCH
, 0);

215 
	`wr™e_ev’t
(
ei
.
fd_touch
, 0, 0, 0);

218 
TOUCH_MOVE
:

224 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_POSITION_X
, 
x
);

225 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_POSITION_Y
, 
y
);

226 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_PRESSURE
, 0x3d);

227 
	`wr™e_ev’t
(
ei
.
fd_touch
, 0, 0, 0);

231 
	}
}

240 
	$maš
(* 
¬gv
[] ,
¬gc
) {

242 
AxisS‘tšg
 
s
;

244 
s
.
css
.
ba£_x
 = 0;

245 
s
.
css
.
ba£_y
 = 0;

247 
s
.
css
.
v›w_width
 = 1280;

248 
s
.
css
.
v›w_height
 = 800;

250 
s
.
css
.
fuÎ_width
 = 1280;

251 
s
.
css
.
fuÎ_height
 = 800;

253 
s
.
pss
.
fuÎ_width
 = 1200;

254 
s
.
pss
.
fuÎ_height
 = 1600;

255 
Pošt
 
š
,
out
;

257 
s
.
css
.
ba£_x
 = (1280 - 500)/2;

258 
s
.
css
.
ba£_y
 = 0;

259 
s
.
css
.
v›w_width
 = 500;

260 
s
.
css
.
v›w_height
 = 800;

262 
s
.
css
.
fuÎ_width
 = 1280;

263 
s
.
css
.
fuÎ_height
 = 800;

265 
s
.
pss
.
fuÎ_width
 = 800;

266 
s
.
pss
.
fuÎ_height
 = 1280;

267 
Pošt
 
š
,
out
;

269 
Ïng
 = -1;

270 
ªg
 = 90;

272 if(
Ïng
 !ğ
ªg
)

273 
	`axis_š™
(&
s
,
ªg
);

275 
	`´štf
("input (x,y): ");

276 
	`sÿnf
("%d",&
š
.
x
);

277 
	`sÿnf
("%d",&
š
.
y
);

278 
out
 = 
	`axis_cÚv”t
(
š
);

279 
	`´štf
("cÚv”ˆ(%d,%dètØ(%d,%d)\n",
š
.
x
,š.
y
,
out
.x,out.y);

281 
Ïng
 = 
ªg
;

285 
	}
}

	@/home/bravo/Projects/Linux/linux-adk/src/axis.h

8 #iâdeà
_AXIS_H


9 
	#_AXIS_H


	)

13 
	#PI
 (3.1415926)

	)

16 
	mTOUCH_DOWN
 = 5,

17 
	mTOUCH_MOVE
 = 4,

18 
	mTOUCH_UP
 = 6,

19 } 
	gC¬AùiÚ
;

23 
	mx
;

24 
	my
;

25 } 
	tPošt
;

29 
	mba£_x
;

30 
	mba£_y
;

31 
	mv›w_height
;

32 
	mv›w_width
;

33 
	mfuÎ_height
;

34 
	mfuÎ_width
;

35 } 
	tC¬Sü“nS‘tšg
;

39 
	mfuÎ_height
;

40 
	mfuÎ_width
;

41 } 
	tPhÚeSü“nS‘tšg
;

45 
C¬Sü“nS‘tšg
 
	mcss
;

46 
PhÚeSü“nS‘tšg
 
	mpss
;

47 } 
	tAxisS‘tšg
 ;

55 
axis_š™
(
AxisS‘tšg
* 
as
 , 
ªgË
);

61 
Pošt
 
axis_cÚv”t
(Pošˆ
p
);

68 
axis_šjeù
(
aùiÚ
, 
Pošt
 
p
);

	@/home/bravo/Projects/Linux/linux-adk/src/device.c

2 
	~<libusb-1.0/libusb.h
>

3 
	~<¡dio.h
>

4 
	~"lšux-adk.h
"

7 
	$·r£_’dpošt
(cÚ¡ 
libusb_’dpošt_desütÜ
 * 
’dpošt
)

9 
	`´štf
(" Endpoint\n");

10 
	`´štf
(" bmA‰ribu‹s: 0x%x\n", 
’dpošt
->
bmA‰ribu‹s
);

11 
	`´štf
(" bEndpoštAdd»ss: 0x%x\n", 
’dpošt
->
bEndpoštAdd»ss
);

13 
	}
}

18 
	$·r£_®t£‰šg
(cÚ¡ 
libusb_š‹rçû_desütÜ
 *
š‹rçû
)

20 
i
;

22 
	`´štf
(" Interface:\n");

23 
	`´štf
(" bIÁ”çûNumb”: %d\n", 
š‹rçû
->
bIÁ”çûNumb”
);

24 
	`´štf
(" bAÉ”Ç‹S‘tšg: %d\n", 
š‹rçû
->
bAÉ”Ç‹S‘tšg
);

25 
	`´štf
(" bNumEndpošts: %d\n", 
š‹rçû
->
bNumEndpošts
);

26 
	`´štf
(" bIÁ”çûCÏss: %d\n", 
š‹rçû
->
bIÁ”çûCÏss
);

27 
	`´štf
(" bIÁ”çûSubCÏss: %d\n", 
š‹rçû
->
bIÁ”çûSubCÏss
);

28 
	`´štf
(" bIÁ”çûPrÙocŞ: %d\n", 
š‹rçû
->
bIÁ”çûPrÙocŞ
);

29 
	`´štf
(" iIÁ”çû: %d\n", 
š‹rçû
->
iIÁ”çû
);

33 ifĞ
š‹rçû
->
bIÁ”çûCÏss
 == 255 &&

34 
š‹rçû
->
bIÁ”çûSubCÏss
 == 66 &&

35 
š‹rçû
->
bIÁ”çûPrÙocŞ
 == 1) {

36 
	`´štf
("Android†ink‡ttached\n");

40 ifĞ
š‹rçû
->
bIÁ”çûCÏss
 == 255 &&

41 
š‹rçû
->
bIÁ”çûSubCÏss
 == 254 &&

42 
š‹rçû
->
bIÁ”çûPrÙocŞ
 == 2) {

45 
i
 = 0; i < 
š‹rçû
->
bNumEndpošts
; i++)

46 
	`·r£_’dpošt
(&
š‹rçû
->
’dpošt
[
i
]);

48 
	}
}

56 
	$·r£_š‹rçû
(cÚ¡ 
libusb_š‹rçû
 *
š‹rçû
)

58 
»t
;

59 
i
;

61 
i
 = 0; i < 
š‹rçû
->
num_®t£‰šg
; i++) {

62 
»t
 = 
	`·r£_®t£‰šg
(&
š‹rçû
->
®t£‰šg
[
i
]);

63 if(
»t
 == 2) „et;

66 
	}
}

73 
	$·r£_cÚfigu¿tiÚ
(
libusb_cÚfig_desütÜ
 *
cÚfig
)

75 
i
;

76 
»t
;

78 
	`´štf
(" Configuration:\n");

79 
	`´štf
(" wTÙ®L’gth: %d\n", 
cÚfig
->
wTÙ®L’gth
);

80 
	`´štf
(" bNumIÁ”çûs: %d\n", 
cÚfig
->
bNumIÁ”çûs
);

81 
	`´štf
(" bCÚfigu¿tiÚV®ue: %d\n", 
cÚfig
->
bCÚfigu¿tiÚV®ue
);

82 
	`´štf
(" iCÚfigu¿tiÚ: %d\n", 
cÚfig
->
iCÚfigu¿tiÚ
);

83 
	`´štf
(" bmA‰ribu‹s: %02xh\n", 
cÚfig
->
bmA‰ribu‹s
);

84 
	`´štf
(" MaxPow”: %d\n", 
cÚfig
->
MaxPow”
);

87 
i
 = 0; i < 
cÚfig
->
bNumIÁ”çûs
; i++) {

88 
»t
 = 
	`·r£_š‹rçû
(&
cÚfig
->
š‹rçû
[
i
]);

89 if(
»t
 == 2) „et;

93 
	}
}

100 
	$·r£_devs
(
vid
)

102 
libusb_deviû
 **
devs
;

103 
libusb_deviû_desütÜ
 
desc
;

104 
libusb_cÚfig_desütÜ
 *
cÚfig
;

105 
ssize_t
 
út
;

106 
»t
, 
i
;

108 
»t
 = 
	`libusb_š™
(
NULL
);

109 ià(
»t
 < 0)

110  
»t
;

112 
út
 = 
	`libusb_g‘_deviû_li¡
(
NULL
, &
devs
);

113 ià(
út
 < 0)

114  ()
út
;

116 
i
 = 0; 
devs
[i]; ++i) {

118 
»t
 = 
	`libusb_g‘_deviû_desütÜ
(
devs
[
i
], &
desc
);

119 ià(
»t
 < 0) {

120 
	`´štf
( "failedo get device descriptori\n");

124 
	`´štf
("deviû‡‰ached: %04x:%04x\n", 
desc
.
idV’dÜ
, desc.
idProduù
);

125 if(
vid
 =ğ0 || 
desc
.
idV’dÜ
 == vid ) {

126 
	`´štf
("vid(0x%xè©ched \n",
desc
.
idV’dÜ
);

127 
»t
 = 
	`libusb_g‘_aùive_cÚfig_desütÜ
(
devs
[
i
], &
cÚfig
);

128 ià(
»t
 !ğ
LIBUSB_SUCCESS
) {

129 
	`´štf
("Failed†ibusb_get_active_config_descriptor\n");

130 
»t
 = -1;

131 
EXIT
;

133 
»t
 = 
	`·r£_cÚfigu¿tiÚ
(
cÚfig
);

137 
EXIT
:

138 
	`libusb_ä“_deviû_li¡
(
devs
, 1);

139  
»t
;

140 
	}
}

148 
	$İ’_¥ecŸl_vid_dev
(
vid
, 
acûssÜy_t
 * 
acc
)

150 
libusb_deviû
 **
devs
;

151 
libusb_deviû_hªdË
 *
hªdË
;

152 
libusb_deviû_desütÜ
 
desc
;

153 
libusb_cÚfig_desütÜ
 *
cÚfig
;

154 
ssize_t
 
út
;

155 
»t
, 
i
;

161 
út
 = 
	`libusb_g‘_deviû_li¡
(
NULL
, &
devs
);

162 ià(
út
 < 0)

163  ()
út
;

165 
i
 = 0; 
devs
[i]; ++i) {

167 
»t
 = 
	`libusb_g‘_deviû_desütÜ
(
devs
[
i
], &
desc
);

168 ià(
»t
 < 0) {

169 
	`´štf
( "failedo get device descriptori\n");

173 
	`´štf
("deviû‡‰ached: %04x:%04x\n", 
desc
.
idV’dÜ
, desc.
idProduù
);

174 if(
desc
.
idV’dÜ
 =ğ
vid
 ) {

175 
	`´štf
("vid(0x%xè©ched \n",
desc
.
idV’dÜ
);

176 
»t
 = 
	`libusb_g‘_aùive_cÚfig_desütÜ
(
devs
[
i
], &
cÚfig
);

177 ià(
»t
 !ğ
LIBUSB_SUCCESS
) {

178 
	`´štf
("Failed†ibusb_get_active_config_descriptor\n");

179 
»t
 = -1;

180 
EXIT
;

182 
»t
 = 
	`·r£_cÚfigu¿tiÚ
(
cÚfig
);

184 
	`libusb_»f_deviû
(
devs
[
i
]);

185 
»t
 = 
	`libusb_İ’
(
devs
[
i
],&
hªdË
);

186 ià(
»t
 !ğ
LIBUSB_SUCCESS
) {

187 
	`´štf
Ğ"Faed†ibusb_İ’(%d)\n",
»t
);

188 
»t
 = -1;

189 
EXIT
;

191 
acc
->
hªdË
 = handle;

192 
	`´štf
( "OK†ibusb_open get handle\n");

198 
EXIT
:

199 
	`libusb_ä“_deviû_li¡
(
devs
, 1);

200  
»t
;

201 
	}
}

	@/home/bravo/Projects/Linux/linux-adk/src/hid.c

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<¡dlib.h
>

26 
	~<¡dšt.h
>

27 
	~<uni¡d.h
>

28 
	~<pŞl.h
>

29 
	~<libusb.h
>

31 
	~"lšux-adk.h
"

32 
	~"hid.h
"

33 
	~"axis.h
"

35 
	~"hid­i.h
"

37 
	#REPORT_ID
 (4)

	)

40 
	#PHONE_WIDTH
 (1080)

	)

41 
	#PHONE_HEIGHT
 (1920)

	)

43 
	#PHONE_WIDTH
 (1600)

	)

44 
	#PHONE_HEIGHT
 (1200)

	)

46 #if(
TOUCHSCREEN_ENABLE
 == 1)

47 
	ghid_»pÜt_desc
[] = {

52 0x85, 
REPORT_ID
,

105 
	sR•Üt
 {

106 
	m»pÜt_id
 ;

108 
	mbTSw™ch
 : 1;

109 
	mbInRªge
 : 1;

110 
	m»£rved
 : 6;

111 } 
	m¡©us
;

112 
	mwXD©a
;

113 
	mwYD©a
;

115 #–ià(
TOUCHSCREEN_ENABLE
 == 2)

117 
	#LOGICAL_MINIMUM_1
 (0x15)

	)

118 
	#LOGICAL_MAXIMUM_1
 (0x25)

	)

119 
	#LOGICAL_MINIMUM_2
 (0x16)

	)

120 
	#LOGICAL_MAXIMUM_2
 (0x26)

	)

123 
	#PHYSICAL_MINIMUM_1
 (0x35)

	)

124 
	#PHYSICAL_MAXIMUM_1
 (0x45)

	)

125 
	#PHYSICAL_MINIMUM_2
 (0x36)

	)

126 
	#PHYSICAL_MAXIMUM_2
 (0x46)

	)

128 
	ghid_»pÜt_desc
[] = {

132 0x85, 
REPORT_ID
,

159 
LOGICAL_MINIMUM_2
, 0x00,0xF8,

160 
LOGICAL_MAXIMUM_2
, 0x00,0x08,

161 
PHYSICAL_MINIMUM_2
, 0x00,0xF8,

162 
PHYSICAL_MAXIMUM_2
, 0x00,0x08,

168 
LOGICAL_MINIMUM_2
, 0x00,0xFC,

169 
LOGICAL_MAXIMUM_2
, 0x00,0x04,

170 
PHYSICAL_MINIMUM_2
, 0x00,0xF8,

171 
PHYSICAL_MAXIMUM_2
, 0x00,0x08,

181 
	sR•Üt
 {

182 
	m»pÜt_id
 ;

184 
	mbTSw™ch
 : 1;

185 
	mbInRªge
 : 1;

186 
	m»£rved
 : 6;

187 } 
	m¡©us
;

188 
	mwXD©a
;

189 
	mwYD©a
;

194 
	$£t_hid_logiÿl_¿nge
(
width
, 
height
)

196 * 
tmp
 = 
hid_»pÜt_desc
;

197 
lb_w
 = 0;

198 
ub_w
 = 
width
;

199 
lb_h
 = 0;

200 
ub_h
 = 
height
;

201 
i
;

203 
STEP_1
,

204 
STEP_2
,

205 
STEP_3
,

206 
STEP_4
,

207 } 
	t_STEP
;

208 
¡•
 = 
STEP_1
;

209 
i
 = 0 ; i < (
hid_»pÜt_desc
); i++) {

211 
¡•
) {

212 
STEP_1
:

213 if(
tmp
[
i
] =ğ
LOGICAL_MINIMUM_2
) {

214 
tmp
[
i
+1] = 
lb_w
 & 0x00FF;

215 
tmp
[
i
+2] = (
lb_w
 & 0xFF00) >> 8;

216 
	`´štf
("lb_w v®(%dè=(0x%02x 0x%02x)",
lb_w
,
tmp
[
i
+1],tmp[i+2]);

217 
¡•
 = 
STEP_2
;

220 
STEP_2
:

221 if(
tmp
[
i
] =ğ
LOGICAL_MAXIMUM_2
) {

222 
tmp
[
i
+1] = 
ub_w
 & 0x00FF;

223 
tmp
[
i
+2] = (
ub_w
 & 0xFF00) >> 8;

224 
	`´štf
("ub_w v®(%dè=(0x%02x 0x%02x)",
ub_w
,
tmp
[
i
+1],tmp[i+2]);

225 
¡•
 = 
STEP_3
;

228 
STEP_3
:

229 if(
tmp
[
i
] =ğ
LOGICAL_MINIMUM_2
) {

230 
tmp
[
i
+1] = 
lb_h
 & 0x00FF;

231 
tmp
[
i
+2] = (
lb_h
 & 0xFF00) >> 8;

232 
	`´štf
("lb_h v®(%dè=(0x%02x 0x%02x)\n",
lb_h
,
tmp
[
i
+1],tmp[i+2]);

233 
¡•
 = 
STEP_4
;

236 
STEP_4
:

238 if(
tmp
[
i
] =ğ
LOGICAL_MAXIMUM_2
) {

239 
tmp
[
i
+1] = 
ub_h
 & 0x00FF;

240 
tmp
[
i
+2] = (
ub_h
 & 0xFF00) >> 8;

241 
	`´štf
("ub_h v®(%dè=(0x%02x 0x%02x)\n",
ub_h
,
tmp
[
i
+1],tmp[i+2]);

242 
’d
;

247 
’d
:

249 
	`´štf
("hid„eport is:\n");

250 
i
 = 0 ; i < (
hid_»pÜt_desc
) ;i++) {

251 
	`´štf
("0x%02x ",
tmp
[
i
]);

252 if(
i
 % 10 == 0)

253 
	`´štf
("\n");

255 
	`´štf
("\n");

256 
	}
}

258 
	$£t_hid_physiÿl_¿nge
(
width
, 
height
)

260 * 
tmp
 = 
hid_»pÜt_desc
;

261 
lb_w
 = 0;

262 
ub_w
 = 
width
;

263 
lb_h
 = 0;

264 
ub_h
 = 
height
;

265 
i
;

267 
STEP_1
,

268 
STEP_2
,

269 
STEP_3
,

270 
STEP_4
,

271 } 
	t_STEP
;

272 
¡•
 = 
STEP_1
;

273 
i
 = 0 ; i < (
hid_»pÜt_desc
); i++) {

275 
¡•
) {

276 
STEP_1
:

277 if(
tmp
[
i
] =ğ
PHYSICAL_MINIMUM_2
) {

278 
tmp
[
i
+1] = 
lb_w
 & 0x00FF;

279 
tmp
[
i
+2] = (
lb_w
 & 0xFF00) >> 8;

280 
	`´štf
("lb_w v®(%dè=(0x%02x 0x%02x)",
lb_w
,
tmp
[
i
+1],tmp[i+2]);

281 
¡•
 = 
STEP_2
;

284 
STEP_2
:

285 if(
tmp
[
i
] =ğ
PHYSICAL_MAXIMUM_2
) {

286 
tmp
[
i
+1] = 
ub_w
 & 0x00FF;

287 
tmp
[
i
+2] = (
ub_w
 & 0xFF00) >> 8;

288 
	`´štf
("ub_w v®(%dè=(0x%02x 0x%02x)",
ub_w
,
tmp
[
i
+1],tmp[i+2]);

289 
¡•
 = 
STEP_3
;

292 
STEP_3
:

293 if(
tmp
[
i
] =ğ
PHYSICAL_MINIMUM_2
) {

294 
tmp
[
i
+1] = 
lb_h
 & 0x00FF;

295 
tmp
[
i
+2] = (
lb_h
 & 0xFF00) >> 8;

296 
	`´štf
("lb_h v®(%dè=(0x%02x 0x%02x)\n",
lb_h
,
tmp
[
i
+1],tmp[i+2]);

297 
¡•
 = 
STEP_4
;

300 
STEP_4
:

301 if(
tmp
[
i
] =ğ
PHYSICAL_MAXIMUM_2
) {

302 
tmp
[
i
+1] = 
ub_h
 & 0x00FF;

303 
tmp
[
i
+2] = (
ub_h
 & 0xFF00) >> 8;

304 
	`´štf
("ub_h v®(%dè=(0x%02x 0x%02x)\n",
ub_h
,
tmp
[
i
+1],tmp[i+2]);

305 
’d
;

310 
’d
:

312 
	`´štf
("hid„eport is:\n");

313 
i
 = 0 ; i < (
hid_»pÜt_desc
) ;i++) {

314 
	`´štf
("0x%02x ",
tmp
[
i
]);

315 if(
i
 % 10 == 0)

316 
	`´štf
("\n");

318 
	`´štf
("\n");

319 
	}
}

322 *
	$»ûive_loİ
(*
¬g
)

324 !
¡İ_acc
) {

325 
»t
 = 0;

326 
i
;

327 
nfds
 = 1;

328 
timev®
 
tv
, 
z”o_tv
;

329 cÚ¡ 
libusb_pŞlfd
 **
pŞl_li¡
;

330 
fd_£t
 
rfds
, 
wfds
, 
efds
;

331 
tv
.
tv_£c
 = 0;

332 
tv
.
tv_u£c
 = 0;

333 
z”o_tv
.
tv_£c
 = 0;

334 
z”o_tv
.
tv_u£c
 = 0;

336 
»t
 = 
	`libusb_g‘_Ãxt_timeout
(
NULL
, &
tv
);

337 ià(
»t
 < 0) {

338 ià(
»t
)

339 
	`´štf
("USBƒrror : %s\n",

340 
	`libusb_”rÜ_Çme
(
»t
));

344 ià(
»t
 =ğ1 && 
tv
.
tv_£c
 =ğ0 &&v.
tv_u£c
 == 0) {

345 
»t
 = 
	`libusb_hªdË_ev’ts_timeout_com¶‘ed
(
NULL
,

346 &
z”o_tv
,

347 
NULL
);

348 ià(
»t
) {

349 ià(
»t
)

350 
	`´štf
("USBƒrror : %s\n",

351 
	`libusb_”rÜ_Çme
(
»t
));

357 
	`FD_ZERO
(&
rfds
);

358 
	`FD_ZERO
(&
wfds
);

359 
	`FD_ZERO
(&
efds
);

360 
	`FD_SET
(0, &
rfds
);

361 
pŞl_li¡
 = 
	`libusb_g‘_pŞlfds
(
NULL
);

362 ià(
pŞl_li¡
) {

363 
i
 = 0; 
pŞl_li¡
[i] !ğ
NULL
; i++) {

364 cÚ¡ 
libusb_pŞlfd
 *
cur_pŞl
;

366 
cur_pŞl
 = 
pŞl_li¡
[
i
];

367 
nfds
 = 
cur_pŞl
->
fd
 >=‚fds

368 ? 
cur_pŞl
->
fd
 + 1 : 
nfds
;

369 ià(
cur_pŞl
->
ev’ts
 & 
POLLIN
)

370 
	`FD_SET
(
cur_pŞl
->
fd
, &
rfds
);

371 ià(
cur_pŞl
->
ev’ts
 & 
POLLOUT
)

372 
	`FD_SET
(
cur_pŞl
->
fd
, &
wfds
);

374 
	`ä“
(
pŞl_li¡
);

378 ià(
tv
.
tv_£c
 =ğ0 &&v.
tv_u£c
 == 0)

379 
»t
 = 
	`£Ëù
(
nfds
, &
rfds
, &
wfds
, &
efds
, 
NULL
);

381 
»t
 = 
	`£Ëù
(
nfds
, &
rfds
, &
wfds
, &
efds
, &
tv
);

383 ià(
libusb_hªdË_ev’ts_timeout_com¶‘ed


384 (
NULL
, &
z”o_tv
, NULL))

388  
NULL
;

389 
	}
}

391 
	$İ’_deviû
(
libusb_deviû_hªdË
 **
hªdË
,

392 
libusb_deviû
 * 
deviû
, 
š‹rçû
)

394 
k”Ãl_şaimed
 = 0, 
»t
;

396 
	`libusb_»f_deviû
(
deviû
);

397 
»t
 = 
	`libusb_İ’
(
deviû
, 
hªdË
);

398 ià(
»t
) {

399 
	`´štf
("UÇbËØİ’ usb deviû [%#08x]\n", 
»t
);

400 *
hªdË
 = 
NULL
;

403 
	`´štf
("libusb_kernel_driver_active\n");

404 
»t
 = 
	`libusb_k”Ãl_driv”_aùive
(*
hªdË
, 
š‹rçû
);

405 ià(
»t
 == 1) {

406 ià(
	`libusb_d‘ach_k”Ãl_driv”
(*
hªdË
, 
š‹rçû
)) {

407 
	`´štf
("Unableo grab usb device\n");

408 
	`libusb_şo£
(*
hªdË
);

409 *
hªdË
 = 
NULL
;

412 
k”Ãl_şaimed
 = 1;

415 
	`´štf
("libusb_claim_interface\n");

416 
»t
 = 
	`libusb_şaim_š‹rçû
(*
hªdË
, 
š‹rçû
);

417 ià(
»t
) {

418 
	`´štf
("FaedØşaim iÁ”çû %d.\n", 
š‹rçû
);

419 ià(
k”Ãl_şaimed
) {

420 
	`libusb_©ch_k”Ãl_driv”
(*
hªdË
, 
š‹rçû
);

421 
k”Ãl_şaimed
 = 0;

423 
	`libusb_şo£
(*
hªdË
);

424 *
hªdË
 = 
NULL
;

429 
	}
}

431 
	$ÿÎback_hid­i
(
acûssÜy_t
 * 
acc
 , * 
bufãr
, 
Ëngth
)

433 
libusb_Œªsãr
 *
ªdroid_Œªsãr
;

434 *
keybuf
;

435 
rc
;

436 
ªdroid_Œªsãr
 = 
	`libusb_®loc_Œªsãr
(0);

437 
s
 = 0;

438 
	`´štf
("orig hid„eport data from mouse:\n");

439 
s
 = 0 ; s < 
Ëngth
; s ++) {

440 
	`´štf
("0x%02x ",(*)
bufãr
);

442 
	`´štf
("\n");

444 
keybuf
 = 
	`m®loc
(
Ëngth
 + 
LIBUSB_CONTROL_SETUP_SIZE
);

445 
	`memıy
(
keybuf
 + 
LIBUSB_CONTROL_SETUP_SIZE
, 
bufãr
,
Ëngth
);

447 
	`libusb_fl_cÚŒŞ_£tup
(
keybuf
,

448 
LIBUSB_ENDPOINT_OUT
 |

449 
LIBUSB_REQUEST_TYPE_VENDOR
,

450 
AOA_SEND_HID_EVENT
, 1, 0,

451 
Ëngth
);

453 
	`libusb_fl_cÚŒŞ_Œªsãr
(
ªdroid_Œªsãr
, 
acc
->
hªdË
,

454 
keybuf
, 
NULL
, NULL, 0);

456 
ªdroid_Œªsãr
->
æags
 =

457 
LIBUSB_TRANSFER_FREE_BUFFER
 | 
LIBUSB_TRANSFER_FREE_TRANSFER
;

459 
rc
 = 
	`libusb_subm™_Œªsãr
(
ªdroid_Œªsãr
);

460 ià(
rc
)

461 
	`´štf
("USBƒ¼Ü : %s\n", 
	`libusb_”rÜ_Çme
(
rc
));

464 
	}
}

466 
	$ÿÎback_hid
(
libusb_Œªsãr
 *
Œªsãr
)

468 
acûssÜy_t
 *
acc
 = 
Œªsãr
->
u£r_d©a
;

469 
rc
 = 0;

471 ià(
Œªsãr
->
¡©us
 =ğ
LIBUSB_TRANSFER_COMPLETED
) {

472 
libusb_Œªsãr
 *
ªdroid_Œªsãr
;

473 *
keybuf
;

474 
rc
;

476 
ªdroid_Œªsãr
 = 
	`libusb_®loc_Œªsãr
(0);

478 
s
 = 0;

480 
	`´štf
("orig hid„eport data from mouse:\n");

481 
s
 = 0 ; s < 
Œªsãr
->
aùu®_Ëngth
; s ++) {

482 
	`´štf
("0x%02x ",
Œªsãr
->
bufãr
[
s
]);

484 
	`´štf
("\n");

486 #if(
TOUCHSCREEN_ENABLE
 == 1)

487 
Œªsãr
->
aùu®_Ëngth
 = (
R•Üt
);

492 
couÁs
 = 0;

494 
R•Üt
 
»pÜt
;

495 
»pÜt
.
»pÜt_id
 = 
REPORT_ID
;

496 if(
couÁs
 != 0) {

497 
»pÜt
.
wXD©a
 = 
couÁs
 % 1080;

498 
»pÜt
.
wYD©a
 = 
couÁs
 * 1920 / 1080 % 1920 ;

500 
»pÜt
.
wXD©a
 =„•Üt.
wYD©a
 = 0;

502 if(
»pÜt
.
wXD©a
 >= 200 &&„eport.wXData <= 900)

503 
»pÜt
.
¡©us
.
bTSw™ch
 = 1;

505 
»pÜt
.
¡©us
.
bTSw™ch
 = 0;

506 
couÁs
 ++;

510 
Œªsãr
->
bufãr
 = (*)&
»pÜt
;

511 #–ià(
TOUCHSCREEN_ENABLE
 == 2)

512 
Œªsãr
->
aùu®_Ëngth
 = (
R•Üt
);

517 
couÁs
 = 0;

519 
R•Üt
 
»pÜt
;

520 
»pÜt
.
»pÜt_id
 = 
REPORT_ID
;

521 if(
couÁs
 != 0) {

522 
»pÜt
.
wXD©a
 = 
couÁs
 * 4 % 
PHONE_HEIGHT
;

523 
»pÜt
.
wYD©a
 = 
couÁs
 * 4 % 
PHONE_WIDTH
 ;

525 
»pÜt
.
wXD©a
 =„•Üt.
wYD©a
 = 0;

527 if(
»pÜt
.
wXD©a
 >= 200 &&„eport.wXData <= 900)

528 
»pÜt
.
¡©us
.
bTSw™ch
 = 1;

530 
»pÜt
.
¡©us
.
bTSw™ch
 = 0;

531 
couÁs
 ++;

536 
Œªsãr
->
bufãr
 = (*)&
»pÜt
;

538 
keybuf
 = 
	`m®loc
(
Œªsãr
->
aùu®_Ëngth
 + 
LIBUSB_CONTROL_SETUP_SIZE
);

539 
	`memıy
(
keybuf
 + 
LIBUSB_CONTROL_SETUP_SIZE
, 
Œªsãr
->
bufãr
,

540 
Œªsãr
->
aùu®_Ëngth
);

542 
	`´štf
("hid„eport data:\n");

543 
s
 = 0 ; s < 
Œªsãr
->
aùu®_Ëngth
; s ++) {

544 
	`´štf
("0x%02x ",
Œªsãr
->
bufãr
[
s
]);

546 
	`´štf
("\n");

549 
	`libusb_fl_cÚŒŞ_£tup
(
keybuf
,

550 
LIBUSB_ENDPOINT_OUT
 |

551 
LIBUSB_REQUEST_TYPE_VENDOR
,

552 
AOA_SEND_HID_EVENT
, 1, 0,

553 
Œªsãr
->
aùu®_Ëngth
);

555 
	`libusb_fl_cÚŒŞ_Œªsãr
(
ªdroid_Œªsãr
, 
acc
->
hªdË
,

556 
keybuf
, 
NULL
, NULL, 0);

558 
ªdroid_Œªsãr
->
æags
 =

559 
LIBUSB_TRANSFER_FREE_BUFFER
 | 
LIBUSB_TRANSFER_FREE_TRANSFER
;

561 
rc
 = 
	`libusb_subm™_Œªsãr
(
ªdroid_Œªsãr
);

562 ià(
rc
)

563 
	`´štf
("USBƒ¼Ü : %s\n", 
	`libusb_”rÜ_Çme
(
rc
));

565 
rc
 = 
	`libusb_subm™_Œªsãr
(
Œªsãr
);

566 ià(
rc
)

567 
	`´štf
("USBƒ¼Ü : %s\n", 
	`libusb_”rÜ_Çme
(
rc
));

569 } ià(
Œªsãr
->
¡©us
 =ğ
LIBUSB_TRANSFER_TIMED_OUT
) {

570 
rc
 = 
	`libusb_subm™_Œªsãr
(
Œªsãr
);

571 ià(
rc
)

572 
	`´štf
("USBƒ¼Ü : %s\n", 
	`libusb_”rÜ_Çme
(
rc
));

574 
	}
}

576 
	$£¬ch_hid
(
hid_deviû_t
 * 
hid
)

578 
libusb_deviû
 **
li¡
;

579 
libusb_deviû_desütÜ
 
desc
;

580 
ssize_t
 
út
;

581 
ssize_t
 
i
 = 0;

582 
j
;

583 
libusb_deviû
 *
deviû
;

585 
hid
->
hªdË
 = 
NULL
;

588 
út
 = 
	`libusb_g‘_deviû_li¡
(
NULL
, &
li¡
);

589 ià(
út
 < 0)

590 
”rÜ0
;

592 
i
 = 0; i < 
út
; i++) {

593 
deviû
 = 
li¡
[
i
];

594 
r
;

596 
	`´štf
("út(%dèi(%dè\n",
út
,
i
);

598 
r
 = 
	`libusb_g‘_deviû_desütÜ
(
deviû
, &
desc
);

599 ià(
r
 < 0)

602 
	`´štf
("desc.bDeviûCÏs ğ%d\n",
desc
.
bDeviûCÏss
);

603 ià(
desc
.
bDeviûCÏss
 =ğ
LIBUSB_CLASS_HID
) {

604 
found
;

606 } ià(
desc
.
bDeviûCÏss
 =ğ
LIBUSB_CLASS_PER_INTERFACE
) {

607 
libusb_cÚfig_desütÜ
 *
cu¼’t_cÚfig
;

608 
r
;

610 
	`´štf
("libusb_get_active_config_descriptor\n");

611 
r
 = 
	`libusb_g‘_aùive_cÚfig_desütÜ
(
deviû
,

612 &
cu¼’t_cÚfig
);

613 ià(
r
 < 0) {

614 
	`´štf
("g‘‡ùivdesø”rÜ(%d)",
r
);

617 
	`´štf
("parse hid cfg interface\n");

621 
	`´štf
("bNumIÁ”çûs(%d)\n",
cu¼’t_cÚfig
->
bNumIÁ”çûs
);

623 
j
 = 0; j < 
cu¼’t_cÚfig
->
bNumIÁ”çûs
; j++) {

624 
k
;

625 
	`´štf
("num_®t£‰šg(%d)\n",
cu¼’t_cÚfig
->
š‹rçû
[
j
].
num_®t£‰šg
);

626 
k
 = 0;

627 
k
 <

628 
cu¼’t_cÚfig
->

629 
š‹rçû
[
j
].
num_®t£‰šg
; 
k
++) {

630 ià(
cu¼’t_cÚfig
->

631 
š‹rçû
[
j
].
®t£‰šg
[
k
].

632 
bIÁ”çûCÏss
 ==

633 
LIBUSB_CLASS_HID
) {

634 
hid
->
’dpošt_š
 =

635 
cu¼’t_cÚfig
->
š‹rçû


636 [
j
].

637 
®t£‰šg
[
k
].
’dpošt


638 [0].
bEndpoštAdd»ss
;

639 
hid
->
·ck‘_size
 =

640 
cu¼’t_cÚfig
->
š‹rçû


641 [
j
].

642 
®t£‰šg
[
k
].
’dpošt
[0].

643 
wMaxPack‘Size
;

644 
	`´štf
("£ˆ’dpošt(0x%x)\n",
hid
->
’dpošt_š
);

645 
found
;

649 
	`´štf
("libusb_free_config_descriptor\n");

650 
	`libusb_ä“_cÚfig_desütÜ
(
cu¼’t_cÚfig
);

654 
	`´štf
("found ...\n");

655 
found
:

656 ià(
i
 =ğ
út
)

657 
”rÜ0
;

659 
	`´štf
("open_device...\n");

660 ià(
	`İ’_deviû
(&
hid
->
hªdË
, 
deviû
, 
j
) < 0)

661 
”rÜ0
;

664 
	`´štf
("GET_DESCRIPTOR...\n");

665 
hid
->
desütÜ_size
 = 
	`libusb_cÚŒŞ_Œªsãr
(hid->
hªdË
,

666 
LIBUSB_ENDPOINT_IN
 |

667 
LIBUSB_RECIPIENT_INTERFACE
,

668 
LIBUSB_REQUEST_GET_DESCRIPTOR
,

669 
LIBUSB_DT_REPORT
 << 8, 0,

670 
hid
->
desütÜ
, 256, 0);

671 ià(
hid
->
desütÜ_size
 < 0)

672 
”rÜ1
;

674 
	`libusb_ä“_deviû_li¡
(
li¡
, 1);

675 
	`´štf
("=> found HID deviû vid 0x%x…id 0x%x\n", 
desc
.
idV’dÜ
,

676 
desc
.
idProduù
);

677 
s
 = 0;

678 
	`´štf
("descriptor: \n");

679 
s
 = 0 ; s < 
hid
->
desütÜ_size
; s ++) {

680 
	`´štf
("0x%02x ",
hid
->
desütÜ
[
s
]);

682 
	`´štf
("\n");

685 
”rÜ1
:

686 
	`libusb_şo£
(
hid
->
hªdË
);

687 
”rÜ0
:

688 
	`libusb_ä“_deviû_li¡
(
li¡
, 1);

690 
	}
}

693 * 
	$rx_hid­i
(* 
·¿
)

695 
acûssÜy_t
 * 
acc
 = (acûssÜy_ˆ*)
·¿
;

696 
buf
[256] = {0};

697 
hid_deviû
 *
hªdË
;

698 
hid_deviû_šfo
 *
devs
, *
cur_dev
;

699 
	`´štf
("rx_hidapi start..\n");

700 ià(
	`hid_š™
())

702 
devs
 = 
	`hid_’um”©e
(0x0, 0x0);

703 
	`´štf
("hid_enumerate\n");

704 
cur_dev
 = 
devs
;

705 
pid
,
vid
;

706 
cur_dev
) {

707 
	`´štf
("Deviû Found\Ày³: %04hx %04hx\À…©h: %s\À s”Ÿl_numb”: %ls", 
cur_dev
->
v’dÜ_id
, cur_dev->
´oduù_id
, cur_dev->
·th
, cur_dev->
£rŸl_numb”
);

708 
	`´štf
("\n");

709 
	`´štf
(" Mªuçùu»r: %ls\n", 
cur_dev
->
mªuçùu»r_¡ršg
);

710 
	`´štf
(" Produù: %ls\n", 
cur_dev
->
´oduù_¡ršg
);

711 
	`´štf
(" R–—£: %hx\n", 
cur_dev
->
»Ëa£_numb”
);

712 
	`´štf
(" IÁ”çû: %d\n", 
cur_dev
->
š‹rçû_numb”
);

713 
	`´štf
("\n");

714 ià(
	`¡r¡r
(
cur_dev
->
´oduù_¡ršg
,"Mouse") || strstr(cur_dev->product_string,"Mouse") ) {

715 
	`´štf
("Mouse found\n");

716 
pid
 = 
cur_dev
->
´oduù_id
;

717 
vid
 = 
cur_dev
->
v’dÜ_id
;

720 
cur_dev
 = cur_dev->
Ãxt
;

722 
	`hid_ä“_’um”©iÚ
(
devs
);

724 
	`´štf
("hid_open\n");

726 
hªdË
 = 
	`hid_İ’
(0x413c, 0x301a, 
NULL
);

727 ià(!
hªdË
) {

728 
	`´štf
("unableo open device\n");

731 
»s
 = -1;

734 
»s
 = 
	`hid_»ad
(
hªdË
, 
buf
, (buf));

735 ià(
»s
 > 0) {

736 
	`ÿÎback_hid­i
(
acc
 , 
buf
, 
»s
);

738 
	`´štf
("”rÜ duršg hid_»ad %d\n",
»s
);

739  
»s
;

742 
	`hid_ex™
();

743 
	}
}

747 
	$»gi¡”_hid­i_ÿÎback
(
acûssÜy_t
 * 
acc
)

749 
±h»ad_t
 
rx_t
;

750 
rx_t
 = 
	`±h»ad_ü—‹
(&rx_t,
NULL
,
rx_hid­i
,
acc
);

752 
	}
}

754 
	$»gi¡”_hid_ÿÎback
(
acûssÜy_t
 * 
acc
, 
hid_deviû_t
 * 
hid
)

756 
libusb_Œªsãr
 *
hid_Œªsãr
;

757 *
keybuf
;

758 
rc
;

760 
AxisS‘tšg
 
£t
;

761 
£t
.
css
.
ba£_x
 = 0 ;

762 
£t
.
css
.
ba£_y
 = 0 ;

763 
£t
.
css
.
v›w_height
 = s‘.css.
fuÎ_height
 = 
PHONE_WIDTH
 ;

764 
£t
.
css
.
v›w_width
 = s‘.css.
fuÎ_width
 = 
PHONE_HEIGHT
;

766 
£t
.
pss
.
fuÎ_width
 = 
PHONE_HEIGHT
;

767 
£t
.
pss
.
fuÎ_height
 = 
PHONE_WIDTH
;

769 
	`axis_š™
(&
£t
,0);

772 
keybuf
 = 
	`m®loc
(
hid
->
·ck‘_size
);

774 
hid_Œªsãr
 = 
	`libusb_®loc_Œªsãr
(0);

775 ià(
hid_Œªsãr
 =ğ
NULL
) {

776 
	`libusb_şo£
(
hid
->
hªdË
);

780 
	`libusb_fl_š‹¼u±_Œªsãr
(
hid_Œªsãr
, 
hid
->
hªdË
,

781 
hid
->
’dpošt_š
,

782 
keybuf
, 
hid
->
·ck‘_size
, 
ÿÎback_hid
,

783 
acc
, 0);

785 
rc
 = 
	`libusb_subm™_Œªsãr
(
hid_Œªsãr
);

786 ià(
rc
 != 0) {

787 ià(
rc
)

788 
	`´štf
("USBƒ¼Ü : %s\n", 
	`libusb_”rÜ_Çme
(
rc
));

789 
	`libusb_şo£
(
hid
->
hªdË
);

794 
	}
}

796 
	$£nd_hid_desütÜ
(
acûssÜy_t
 * 
acc
, 
hid_deviû_t
 * 
hid
)

798 
»t
;

800 
	`´štf
("register hid\n");

801 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
, 
LIBUSB_ENDPOINT_OUT
 |

802 
LIBUSB_REQUEST_TYPE_VENDOR
,

803 #ifdeà
TOUCHSCREEN_ENABLE


804 
AOA_REGISTER_HID
, 1, (
hid_»pÜt_desc
),

806 
AOA_REGISTER_HID
, 1, 
hid
->
desütÜ_size
,

808 
NULL
, 0, 0);

809 ià(
»t
 < 0) {

810 
	`´štf
("couldn't„egister HID device onhe‡ndroid device : %s\n",

811 
	`libusb_”rÜ_Çme
(
»t
));

812 
	`libusb_şo£
(
hid
->
hªdË
);

816 
	`´štf
("send hid„eport\n");

817 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
, 
LIBUSB_ENDPOINT_OUT
 |

818 
LIBUSB_REQUEST_TYPE_VENDOR
,

819 
AOA_SET_HID_REPORT_DESC
, 1, 0,

820 #ifdeà
TOUCHSCREEN_ENABLE


821 
hid_»pÜt_desc
, (hid_report_desc), 0);

823 
hid
->
desütÜ
, hid->
desütÜ_size
, 0);

825 ià(
»t
 < 0) {

826 
	`´štf
("couldn't send HID descriptorohe‡ndroid device\n");

827 
	`libusb_şo£
(
hid
->
hªdË
);

834 
	`»gi¡”_hid­i_ÿÎback
(
acc
);

836 
	`±h»ad_ü—‹
(&
hid
->
rx_th»ad
, 
NULL
, 
»ûive_loİ
, NULL);

839 
	}
}

	@/home/bravo/Projects/Linux/linux-adk/src/hid.h

21 #iâdeà
_HID_H_


22 
	#_HID_H_


	)

24 
	~<±h»ad.h
>

28 
libusb_deviû_hªdË
 *
	mhªdË
;

29 
	mdesütÜ
[256];

30 
	mdesütÜ_size
;

31 
	m’dpošt_š
;

32 
ssize_t
 
	m·ck‘_size
;

33 
±h»ad_t
 
	mrx_th»ad
;

34 } 
	thid_deviû_t
;

37 
£nd_hid_desütÜ
(
acûssÜy_t
 *
acc
, 
hid_deviû_t
 *
hid
);

38 
»gi¡”_hid_ÿÎback
(
acûssÜy_t
* 
acc
, 
hid_deviû_t
 *
hid
);

39 
£¬ch_hid
(
hid_deviû_t
 *
hid
);

	@/home/bravo/Projects/Linux/linux-adk/src/hidapi.h

27 #iâdeà
HIDAPI_H__


28 
	#HIDAPI_H__


	)

30 
	~<wch¬.h
>

32 #ifdeà
_WIN32


33 
	#HID_API_EXPORT
 
	`__deş¥ec
(
dÎexpÜt
)

	)

34 
	#HID_API_CALL


	)

36 
	#HID_API_EXPORT


	)

37 
	#HID_API_CALL


	)

40 
	#HID_API_EXPORT_CALL
 
HID_API_EXPORT
 
HID_API_CALL


	)

42 #ifdeà
__ılu¥lus


45 
hid_deviû_
;

46 
hid_deviû_
 
	thid_deviû
;

49 
	shid_deviû_šfo
 {

51 *
·th
;

53 
v’dÜ_id
;

55 
´oduù_id
;

57 
wch¬_t
 *
£rŸl_numb”
;

60 
»Ëa£_numb”
;

62 
wch¬_t
 *
mªuçùu»r_¡ršg
;

64 
wch¬_t
 *
´oduù_¡ršg
;

67 
u§ge_·ge
;

70 
u§ge
;

75 
š‹rçû_numb”
;

78 
hid_deviû_šfo
 *
Ãxt
;

96 
HID_API_EXPORT
 
HID_API_CALL
 
hid_š™
();

109 
HID_API_EXPORT
 
HID_API_CALL
 
hid_ex™
();

132 
hid_deviû_šfo
 
HID_API_EXPORT
 * 
HID_API_CALL
 
hid_’um”©e
(
v’dÜ_id
, 
´oduù_id
);

142 
HID_API_EXPORT
 
HID_API_CALL
 
hid_ä“_’um”©iÚ
(
hid_deviû_šfo
 *
devs
);

160 
HID_API_EXPORT
 
hid_deviû
 * 
HID_API_CALL
 
hid_İ’
(
v’dÜ_id
, 
´oduù_id
, cÚ¡ 
wch¬_t
 *
£rŸl_numb”
);

175 
HID_API_EXPORT
 
hid_deviû
 * 
HID_API_CALL
 
hid_İ’_·th
(cÚ¡ *
·th
);

203 
HID_API_EXPORT
 
HID_API_CALL
 
hid_wr™e
(
hid_deviû
 *
deviû
, cÚ¡ *
d©a
, 
size_t
 
Ëngth
);

224 
HID_API_EXPORT
 
HID_API_CALL
 
hid_»ad_timeout
(
hid_deviû
 *
dev
, *
d©a
, 
size_t
 
Ëngth
, 
mli£cÚds
);

244 
HID_API_EXPORT
 
HID_API_CALL
 
hid_»ad
(
hid_deviû
 *
deviû
, *
d©a
, 
size_t
 
Ëngth
);

264 
HID_API_EXPORT
 
HID_API_CALL
 
hid_£t_nÚblockšg
(
hid_deviû
 *
deviû
, 
nÚblock
);

292 
HID_API_EXPORT
 
HID_API_CALL
 
hid_£nd_ã©u»_»pÜt
(
hid_deviû
 *
deviû
, cÚ¡ *
d©a
, 
size_t
 
Ëngth
);

317 
HID_API_EXPORT
 
HID_API_CALL
 
hid_g‘_ã©u»_»pÜt
(
hid_deviû
 *
deviû
, *
d©a
, 
size_t
 
Ëngth
);

324 
HID_API_EXPORT
 
HID_API_CALL
 
hid_şo£
(
hid_deviû
 *
deviû
);

336 
HID_API_EXPORT_CALL
 
hid_g‘_mªuçùu»r_¡ršg
(
hid_deviû
 *
deviû
, 
wch¬_t
 *
¡ršg
, 
size_t
 
maxËn
);

348 
HID_API_EXPORT_CALL
 
hid_g‘_´oduù_¡ršg
(
hid_deviû
 *
deviû
, 
wch¬_t
 *
¡ršg
, 
size_t
 
maxËn
);

360 
HID_API_EXPORT_CALL
 
hid_g‘_£rŸl_numb”_¡ršg
(
hid_deviû
 *
deviû
, 
wch¬_t
 *
¡ršg
, 
size_t
 
maxËn
);

373 
HID_API_EXPORT_CALL
 
hid_g‘_šdexed_¡ršg
(
hid_deviû
 *
deviû
, 
¡ršg_šdex
, 
wch¬_t
 *
¡ršg
, 
size_t
 
maxËn
);

384 
HID_API_EXPORT
 cÚ¡ 
wch¬_t
* 
HID_API_CALL
 
hid_”rÜ
(
hid_deviû
 *
deviû
);

386 #ifdeà
__ılu¥lus


	@/home/bravo/Projects/Linux/linux-adk/src/linux-adk.c

21 
	~<¡dio.h
>

22 
	~<¡ršg.h
>

23 
	~<¡dlib.h
>

24 
	~<uni¡d.h
>

25 
	~<sigÇl.h
>

27 
	~<libusb.h
>

29 
	~"lšux-adk.h
"

31 
acûssÜy_maš
(
acûssÜy_t
 * 
acc
);

33 vŞ©
	g¡İ_acc
 = 0;

46 cÚ¡ 
acûssÜy_t
 
	gacc_deçuÉ
 = {

47 .
deviû
 = "2a45:2008",

48 .
	gmªuçùu»r
 = "Hello Inc",

49 .
	gmod–
 = "HelloWorldModel",

50 .
	gv”siÚ
 = "2.0",

51 .
	gdesütiÚ
 = "Demo ABS2013",

52 .
	gu¾
 = "https://github.com/gibsson",

53 .
	g£rŸl
 = "0000000012345678",

57 cÚ¡ 
acûssÜy_t
 
acc_deçuÉ
 = {

58 .
deviû
 = "05c6:901d",

59 .
	gmªuçùu»r
 = "leautolinknetworks",

60 .
	gmod–
 = "ecolink",

61 .
	gv”siÚ
 = "01",

62 .
	gdesütiÚ
 = "baby",

63 .
	gu¾
 = "https://github.com/gibsson",

64 .
	g£rŸl
 = "0000000012345678",

69 
is_acûssÜy_´e£Á
(
acûssÜy_t
 * 
acc
);

70 
š™_acûssÜy
(
acûssÜy_t
 * 
acc
);

71 
fši_acûssÜy
(
acûssÜy_t
 * 
acc
);

73 * 
	$utf8
(cÚ¡ *
¡r
)

75 *
utf8
;

76 
utf8
 = (*)
	`m®loc
(1+(2*
	`¡¾’
(
¡r
)));

78 ià(
utf8
) {

79 *
c
 = 
utf8
;

80 ; *
¡r
; ++str) {

81 ià(*
¡r
 & 0x80) {

82 *
c
++ = *
¡r
;

84 *
c
++ = (è(0xc0 | (è*
¡r
 >> 6);

85 *
c
++ = (è(0x80 | (*
¡r
 & 0x3f));

88 *
c
++ = '\0';

90  
utf8
;

91 
	}
}

94 
	$sigÇl_hªdËr
(
signo
)

96 
	`´štf
("SIGINT: Closing‡ccessory\n");

97 
¡İ_acc
 = 1;

98 
	}
}

100 
	$maš
(
¬gc
, *
¬gv
[])

102 
¬g_couÁ
 = 1;

103 
no_­p
 = 0;

104 
acûssÜy_t
 
acc
 = { 
NULL
, NULL, 0, 0, 0, NULL, NULL, NULL, NULL, NULL,

105 
NULL
, NULL

108 ià(
	`sigÇl
(
SIGINT
, 
sigÇl_hªdËr
è=ğ
SIG_ERR
)

109 
	`´štf
("Cannot setup‡ signal handler...\n");

112 
¬g_couÁ
 < 
¬gc
) {

113 ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-d") == 0)

114 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--device") == 0)) {

115 
acc
.
deviû
 = 
¬gv
[++
¬g_couÁ
];

116 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-D") == 0)

117 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--description")

119 
acc
.
desütiÚ
 = 
¬gv
[++
¬g_couÁ
];

120 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-m") == 0)

121 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--manufacturer")

123 
acc
.
mªuçùu»r
 = 
¬gv
[++
¬g_couÁ
];

124 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-M") == 0)

125 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--model") == 0)) {

126 
acc
.
mod–
 = 
¬gv
[++
¬g_couÁ
];

127 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-n") == 0)

128 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--versionnumber")

130 
acc
.
v”siÚ
 = 
¬gv
[++
¬g_couÁ
];

131 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-N") == 0)

132 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--no_app") == 0)) {

133 
no_­p
 = 1;

134 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-s") == 0)

135 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--serial") == 0)) {

136 
acc
.
£rŸl
 = 
¬gv
[++
¬g_couÁ
];

137 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-u") == 0)

138 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--url") == 0)) {

139 
acc
.
u¾
 = 
¬gv
[++
¬g_couÁ
];

140 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-v") == 0)

141 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--version") == 0)) {

143 
	`ex™
(1);

146 
	`ex™
(1);

148 
¬g_couÁ
++;

152 ià(!
acc
.
deviû
)

153 
acc
.
deviû
 = 
acc_deçuÉ
.device;

154 ià(!
acc
.
desütiÚ
)

155 
acc
.
desütiÚ
 = 
acc_deçuÉ
.description;

156 ià(!
acc
.
mªuçùu»r
 && !
no_­p
)

157 
acc
.
mªuçùu»r
 = 
acc_deçuÉ
.manufacturer;

158 ià(!
acc
.
mod–
 && !
no_­p
)

159 
acc
.
mod–
 = 
acc_deçuÉ
.model;

160 ià(!
acc
.
v”siÚ
)

161 
acc
.
v”siÚ
 = 
acc_deçuÉ
.version;

162 ià(!
acc
.
£rŸl
)

163 
acc
.
£rŸl
 = 
acc_deçuÉ
.serial;

164 ià(!
acc
.
u¾
)

165 
acc
.
u¾
 = 
acc_deçuÉ
.url;

167 ià(
	`š™_acûssÜy
(&
acc
) != 0)

168 
’d
;

170 
	`»gi¡”_hid­i_ÿÎback
(&
acc
);

171 
	`¦“p
(5);

174 
	`acûssÜy_maš
(&
acc
);

176 
’d
:

177 
	`fši_acûssÜy
(&
acc
);

179 
	}
}

181 
	$š™_acûssÜy
(
acûssÜy_t
 * 
acc
)

183 
»t
;

184 
ušt16_t
 
pid
, 
vid
;

185 *
tmp
;

186 
ušt8_t
 
bufãr
[2];

187 
Œ›s
 = 1;

190 
»t
 = 
	`libusb_š™
(
NULL
);

191 ià(
»t
 != 0) {

192 
	`´štf
("libusb in™ faed: %d\n", 
»t
);

193  
»t
;

196 
	`·r£_devs
(
vid
);

200 ià(
	`is_acûssÜy_´e£Á
(
acc
))

204 
vid
 = (
ušt16_t
è
	`¡¹Ş
(
acc
->
deviû
, &
tmp
, 16);

205 
pid
 = (
ušt16_t
è
	`¡¹Ş
(
tmp
 + 1, &tmp, 16);

206 
	`´štf
("Lookšg fÜ deviû %4.4x:%4.4x\n", 
vid
, 
pid
);

209 
acc
->
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

210 ià(
acc
->
hªdË
 =ğ
NULL
) {

211 
	`´štf
("Unableo open device...\n");

214 
	`´štf
("O³Àdeviû(%4.4x %4.4xèok\n",
vid
, 
pid
);

217 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

218 
LIBUSB_ENDPOINT_IN
 |

219 
LIBUSB_REQUEST_TYPE_VENDOR
,

220 
AOA_GET_PROTOCOL
, 0, 0, 
bufãr
,

221 (
bufãr
), 0);

222 ià(
»t
 < 0) {

223 
	`´štf
("Error getting…rotocol...\n");

224  
»t
;

226 
acc
->
aß_v”siÚ
 = ((
bufãr
[1] << 8) | buffer[0]);

227 
	`´štf
("Deviû suµÜt AOA %d.0!\n", 
acc
->
aß_v”siÚ
);

231 
	`u¦“p
(10000);

234 ià((
acc
->
aß_v”siÚ
 < 2è&& !acc->
mªuçùu»r
) {

235 
	`´štf
("Connecting without‡n Android App only for AOA 2.0\n");

239 
	`´štf
("Sending identificationohe device\n");

240 ià(
acc
->
mªuçùu»r
) {

241 
	`´štf
(" s’dšg mªuçùu»r: %s\n", 
acc
->
mªuçùu»r
);

242 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

243 
LIBUSB_ENDPOINT_OUT


244 | 
LIBUSB_REQUEST_TYPE_VENDOR
,

245 
AOA_SEND_IDENT
, 0,

246 
AOA_STRING_MAN_ID
,

247 
	`utf8
(
acc
->
mªuçùu»r
),

248 
	`¡¾’
(
acc
->
mªuçùu»r
) + 1, 0);

249 ià(
»t
 < 0)

250 
”rÜ
;

253 
	`u¦“p
(10000);

254 ià(
acc
->
mod–
) {

255 
	`´štf
(" s’dšg mod–: %s\n", 
acc
->
mod–
);

256 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

257 
LIBUSB_ENDPOINT_OUT


258 | 
LIBUSB_REQUEST_TYPE_VENDOR
,

259 
AOA_SEND_IDENT
, 0,

260 
AOA_STRING_MOD_ID
,

261 (
ušt8_t
 *è
acc
->
mod–
,

262 
	`¡¾’
(
acc
->
mod–
) + 1, 0);

263 ià(
»t
 < 0)

264 
”rÜ
;

269 
	`u¦“p
(10000);

270 
	`´štf
(" s’dšg desütiÚ: %s\n", 
acc
->
desütiÚ
);

271 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

272 
LIBUSB_ENDPOINT_OUT
 |

273 
LIBUSB_REQUEST_TYPE_VENDOR
,

274 
AOA_SEND_IDENT
, 0, 
AOA_STRING_DSC_ID
,

275 (
ušt8_t
 *è
acc
->
desütiÚ
,

276 
	`¡¾’
(
acc
->
desütiÚ
) + 1, 0);

277 ià(
»t
 < 0)

278 
”rÜ
;

280 
	`u¦“p
(10000);

281 
	`´štf
(" s’dšg v”siÚ: %s\n", 
acc
->
v”siÚ
);

282 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

283 
LIBUSB_ENDPOINT_OUT
 |

284 
LIBUSB_REQUEST_TYPE_VENDOR
,

285 
AOA_SEND_IDENT
, 0, 
AOA_STRING_VER_ID
,

286 (
ušt8_t
 *è
acc
->
v”siÚ
,

287 
	`¡¾’
(
acc
->
v”siÚ
) + 1, 0);

288 ià(
»t
 < 0)

289 
”rÜ
;

291 
	`u¦“p
(10000);

292 
	`´štf
(" s’dšg u¾: %s\n", 
acc
->
u¾
);

293 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

294 
LIBUSB_ENDPOINT_OUT
 |

295 
LIBUSB_REQUEST_TYPE_VENDOR
,

296 
AOA_SEND_IDENT
, 0, 
AOA_STRING_URL_ID
,

297 (
ušt8_t
 *è
acc
->
u¾
,

298 
	`¡¾’
(
acc
->
u¾
) + 1, 0);

299 ià(
»t
 < 0)

300 
”rÜ
;

302 
	`u¦“p
(10000);

303 
	`´štf
(" s’dšg s”ŸÈnumb”: %s\n", 
acc
->
£rŸl
);

304 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

305 
LIBUSB_ENDPOINT_OUT
 |

306 
LIBUSB_REQUEST_TYPE_VENDOR
,

307 
AOA_SEND_IDENT
, 0, 
AOA_STRING_SER_ID
,

308 (
ušt8_t
 *è
acc
->
£rŸl
,

309 
	`¡¾’
(
acc
->
£rŸl
) + 1, 0);

310 ià(
»t
 < 0)

311 
”rÜ
;

314 ià(
acc
->
aß_v”siÚ
 >= 2) {

315 
	`´štf
("‡sking for‡udio support\n");

316 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

317 
LIBUSB_ENDPOINT_OUT


318 | 
LIBUSB_REQUEST_TYPE_VENDOR
,

319 
AOA_AUDIO_SUPPORT
, 1, 0, 0, 0, 0);

320 ià(
»t
 < 0)

321 
”rÜ
;

325 
	`u¦“p
(20000);

326 
	`´štf
("Turninghe device in Accessory mode ...");

327 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

328 
LIBUSB_ENDPOINT_OUT
 |

329 
LIBUSB_REQUEST_TYPE_VENDOR
,

330 
AOA_START_ACCESSORY
, 0, 0, 
NULL
, 0, 0);

331 ià(
»t
 < 0) {

332 
	`´štf
("failed\n");

333 
”rÜ
;

337 
	`u¦“p
(20000);

339 
Œ›s
 = 2;

341 
Œ›s
--) {

342 ià(
	`is_acûssÜy_´e£Á
(
acc
))

346 
	`¦“p
(1);

350 
	`İ’_¥ecŸl_vid_dev
(
vid
, 
acûssÜy_t
 * 
acc
);

351 
»t
 = 
	`İ’_¥ecŸl_vid_dev
(
AOA_ACCESSORY_VID
,
acc
);

352 if(
»t
 != 0 ) {

353 
	`´štf
("open_special_vid_dev failed\n");

359 
”rÜ
:

360 
	`´štf
("AcûssÜy in™ faed: %d\n", 
»t
);

362 
	}
}

365 
	$is_acûssÜy_´e£Á
(
acûssÜy_t
 * 
acc
)

367 
	`´štf
("is_accessory_present ..\n");

368 
libusb_deviû_hªdË
 *
hªdË
;

369 
ušt16_t
 
vid
 = 
AOA_ACCESSORY_VID
;

370 
ušt16_t
 
pid
 = 0;

372 
	`´štf
("open AOA_ACCESSORY_PID ...");

374 
pid
 = 
AOA_ACCESSORY_PID
;

375 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

376 ià(
hªdË
 !ğ
NULL
)

377 
şaim
;

380 
pid
 = 
AOA_ACCESSORY_ADB_PID
;

381 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

382 ià(
hªdË
 !ğ
NULL
)

383 
şaim
;

385 
pid
 = 
AOA_AUDIO_PID
;

386 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

387 ià(
hªdË
 !ğ
NULL
)

388 
şaim
;

390 
pid
 = 
AOA_AUDIO_ADB_PID
;

391 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

392 ià(
hªdË
 !ğ
NULL
)

393 
şaim
;

395 
pid
 = 
AOA_ACCESSORY_AUDIO_PID
;

396 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

397 ià(
hªdË
 !ğ
NULL
)

398 
şaim
;

400 
pid
 = 
AOA_ACCESSORY_AUDIO_ADB_PID
;

401 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

402 ià(
hªdË
 !ğ
NULL
)

403 
şaim
;

405 
	`´štf
("not…resent\n");

408 
şaim
:

409 
	`´štf
("Found‡cûssÜy %4.4x:%4.4x\n", 
vid
, 
pid
);

410 
acc
->
hªdË
 = handle;

411 
acc
->
vid
 = vid;

412 
acc
->
pid
 =…id;

414 
	}
}

416 
	$fši_acûssÜy
(
acûssÜy_t
 * 
acc
)

418 
	`´štf
("Closing USB device\n");

420 ià(
acc
->
hªdË
 !ğ
NULL
) {

421 
	`libusb_»Ëa£_š‹rçû
(
acc
->
hªdË
, 0);

422 
	`libusb_şo£
(
acc
->
hªdË
);

425 
	`libusb_ex™
(
NULL
);

428 
	}
}

	@/home/bravo/Projects/Linux/linux-adk/src/linux-adk.h

21 #iâdeà
_LINUX_ADK_H_


22 
	#_LINUX_ADK_H_


	)

24 
	~<¡dšt.h
>

27 
	#AOA_GET_PROTOCOL
 51

	)

28 
	#AOA_SEND_IDENT
 52

	)

29 
	#AOA_START_ACCESSORY
 53

	)

30 
	#AOA_REGISTER_HID
 54

	)

31 
	#AOA_UNREGISTER_HID
 55

	)

32 
	#AOA_SET_HID_REPORT_DESC
 56

	)

33 
	#AOA_SEND_HID_EVENT
 57

	)

34 
	#AOA_AUDIO_SUPPORT
 58

	)

37 
	#AOA_STRING_MAN_ID
 0

	)

38 
	#AOA_STRING_MOD_ID
 1

	)

39 
	#AOA_STRING_DSC_ID
 2

	)

40 
	#AOA_STRING_VER_ID
 3

	)

41 
	#AOA_STRING_URL_ID
 4

	)

42 
	#AOA_STRING_SER_ID
 5

	)

45 
	#AOA_ACCESSORY_VID
 0x18D1

	)

46 
	#AOA_ACCESSORY_PID
 0x2D00

	)

47 
	#AOA_ACCESSORY_ADB_PID
 0x2D01

	)

48 
	#AOA_AUDIO_PID
 0x2D02

	)

49 
	#AOA_AUDIO_ADB_PID
 0x2D03

	)

50 
	#AOA_ACCESSORY_AUDIO_PID
 0x2D04

	)

51 
	#AOA_ACCESSORY_AUDIO_ADB_PID
 0x2D05

	)

54 
	#AOA_ACCESSORY_EP_IN
 0x81

	)

55 
	#AOA_ACCESSORY_EP_OUT
 0x02

	)

56 
	#AOA_ACCESSORY_INTERFACE
 0x00

	)

59 
	#PACKAGE_VERSION
 "0.3"

	)

60 
	#PACKAGE_BUGREPORT
 "bissÚ.g¬y@gma.com"

	)

63 vŞ©
¡İ_acc
;

66 
	s_acûssÜy_t
 {

67 
libusb_deviû_hªdË
 *
	mhªdË
;

68 
libusb_Œªsãr
 *
	mŒªsãr
;

69 
ušt32_t
 
	maß_v”siÚ
;

70 
ušt16_t
 
	mvid
;

71 
ušt16_t
 
	mpid
;

72 *
	mdeviû
;

73 *
	mmªuçùu»r
;

74 *
	mmod–
;

75 *
	mdesütiÚ
;

76 *
	mv”siÚ
;

77 *
	mu¾
;

78 *
	m£rŸl
;

79 } 
	tacûssÜy_t
;

	@axis.h

8 #iâdeà
_AXIS_H


9 
	#_AXIS_H


	)

13 
	#PI
 (3.1415926)

	)

16 
	mTOUCH_DOWN
 = 5,

17 
	mTOUCH_MOVE
 = 4,

18 
	mTOUCH_UP
 = 6,

19 } 
	gC¬AùiÚ
;

23 
	mx
;

24 
	my
;

25 } 
	tPošt
;

29 
	mba£_x
;

30 
	mba£_y
;

31 
	mv›w_height
;

32 
	mv›w_width
;

33 
	mfuÎ_height
;

34 
	mfuÎ_width
;

35 } 
	tC¬Sü“nS‘tšg
;

39 
	mfuÎ_height
;

40 
	mfuÎ_width
;

41 } 
	tPhÚeSü“nS‘tšg
;

45 
C¬Sü“nS‘tšg
 
	mcss
;

46 
PhÚeSü“nS‘tšg
 
	mpss
;

47 } 
	tAxisS‘tšg
 ;

55 
axis_š™
(
AxisS‘tšg
* 
as
 , 
ªgË
);

61 
Pošt
 
axis_cÚv”t
(Pošˆ
p
);

68 
axis_šjeù
(
aùiÚ
, 
Pošt
 
p
);

	@hid.h

21 #iâdeà
_HID_H_


22 
	#_HID_H_


	)

24 
	~<±h»ad.h
>

28 
libusb_deviû_hªdË
 *
	mhªdË
;

29 
	mdesütÜ
[256];

30 
	mdesütÜ_size
;

31 
	m’dpošt_š
;

32 
ssize_t
 
	m·ck‘_size
;

33 
±h»ad_t
 
	mrx_th»ad
;

34 } 
	thid_deviû_t
;

37 
£nd_hid_desütÜ
(
acûssÜy_t
 *
acc
, 
hid_deviû_t
 *
hid
);

38 
»gi¡”_hid_ÿÎback
(
acûssÜy_t
* 
acc
, 
hid_deviû_t
 *
hid
);

39 
£¬ch_hid
(
hid_deviû_t
 *
hid
);

	@hidapi.h

27 #iâdeà
HIDAPI_H__


28 
	#HIDAPI_H__


	)

30 
	~<wch¬.h
>

32 #ifdeà
_WIN32


33 
	#HID_API_EXPORT
 
	`__deş¥ec
(
dÎexpÜt
)

	)

34 
	#HID_API_CALL


	)

36 
	#HID_API_EXPORT


	)

37 
	#HID_API_CALL


	)

40 
	#HID_API_EXPORT_CALL
 
HID_API_EXPORT
 
HID_API_CALL


	)

42 #ifdeà
__ılu¥lus


45 
hid_deviû_
;

46 
hid_deviû_
 
	thid_deviû
;

49 
	shid_deviû_šfo
 {

51 *
·th
;

53 
v’dÜ_id
;

55 
´oduù_id
;

57 
wch¬_t
 *
£rŸl_numb”
;

60 
»Ëa£_numb”
;

62 
wch¬_t
 *
mªuçùu»r_¡ršg
;

64 
wch¬_t
 *
´oduù_¡ršg
;

67 
u§ge_·ge
;

70 
u§ge
;

75 
š‹rçû_numb”
;

78 
hid_deviû_šfo
 *
Ãxt
;

96 
HID_API_EXPORT
 
HID_API_CALL
 
hid_š™
();

109 
HID_API_EXPORT
 
HID_API_CALL
 
hid_ex™
();

132 
hid_deviû_šfo
 
HID_API_EXPORT
 * 
HID_API_CALL
 
hid_’um”©e
(
v’dÜ_id
, 
´oduù_id
);

142 
HID_API_EXPORT
 
HID_API_CALL
 
hid_ä“_’um”©iÚ
(
hid_deviû_šfo
 *
devs
);

160 
HID_API_EXPORT
 
hid_deviû
 * 
HID_API_CALL
 
hid_İ’
(
v’dÜ_id
, 
´oduù_id
, cÚ¡ 
wch¬_t
 *
£rŸl_numb”
);

175 
HID_API_EXPORT
 
hid_deviû
 * 
HID_API_CALL
 
hid_İ’_·th
(cÚ¡ *
·th
);

203 
HID_API_EXPORT
 
HID_API_CALL
 
hid_wr™e
(
hid_deviû
 *
deviû
, cÚ¡ *
d©a
, 
size_t
 
Ëngth
);

224 
HID_API_EXPORT
 
HID_API_CALL
 
hid_»ad_timeout
(
hid_deviû
 *
dev
, *
d©a
, 
size_t
 
Ëngth
, 
mli£cÚds
);

244 
HID_API_EXPORT
 
HID_API_CALL
 
hid_»ad
(
hid_deviû
 *
deviû
, *
d©a
, 
size_t
 
Ëngth
);

264 
HID_API_EXPORT
 
HID_API_CALL
 
hid_£t_nÚblockšg
(
hid_deviû
 *
deviû
, 
nÚblock
);

292 
HID_API_EXPORT
 
HID_API_CALL
 
hid_£nd_ã©u»_»pÜt
(
hid_deviû
 *
deviû
, cÚ¡ *
d©a
, 
size_t
 
Ëngth
);

317 
HID_API_EXPORT
 
HID_API_CALL
 
hid_g‘_ã©u»_»pÜt
(
hid_deviû
 *
deviû
, *
d©a
, 
size_t
 
Ëngth
);

324 
HID_API_EXPORT
 
HID_API_CALL
 
hid_şo£
(
hid_deviû
 *
deviû
);

336 
HID_API_EXPORT_CALL
 
hid_g‘_mªuçùu»r_¡ršg
(
hid_deviû
 *
deviû
, 
wch¬_t
 *
¡ršg
, 
size_t
 
maxËn
);

348 
HID_API_EXPORT_CALL
 
hid_g‘_´oduù_¡ršg
(
hid_deviû
 *
deviû
, 
wch¬_t
 *
¡ršg
, 
size_t
 
maxËn
);

360 
HID_API_EXPORT_CALL
 
hid_g‘_£rŸl_numb”_¡ršg
(
hid_deviû
 *
deviû
, 
wch¬_t
 *
¡ršg
, 
size_t
 
maxËn
);

373 
HID_API_EXPORT_CALL
 
hid_g‘_šdexed_¡ršg
(
hid_deviû
 *
deviû
, 
¡ršg_šdex
, 
wch¬_t
 *
¡ršg
, 
size_t
 
maxËn
);

384 
HID_API_EXPORT
 cÚ¡ 
wch¬_t
* 
HID_API_CALL
 
hid_”rÜ
(
hid_deviû
 *
deviû
);

386 #ifdeà
__ılu¥lus


	@linux-adk.h

21 #iâdeà
_LINUX_ADK_H_


22 
	#_LINUX_ADK_H_


	)

24 
	~<¡dšt.h
>

27 
	#AOA_GET_PROTOCOL
 51

	)

28 
	#AOA_SEND_IDENT
 52

	)

29 
	#AOA_START_ACCESSORY
 53

	)

30 
	#AOA_REGISTER_HID
 54

	)

31 
	#AOA_UNREGISTER_HID
 55

	)

32 
	#AOA_SET_HID_REPORT_DESC
 56

	)

33 
	#AOA_SEND_HID_EVENT
 57

	)

34 
	#AOA_AUDIO_SUPPORT
 58

	)

37 
	#AOA_STRING_MAN_ID
 0

	)

38 
	#AOA_STRING_MOD_ID
 1

	)

39 
	#AOA_STRING_DSC_ID
 2

	)

40 
	#AOA_STRING_VER_ID
 3

	)

41 
	#AOA_STRING_URL_ID
 4

	)

42 
	#AOA_STRING_SER_ID
 5

	)

45 
	#AOA_ACCESSORY_VID
 0x18D1

	)

46 
	#AOA_ACCESSORY_PID
 0x2D00

	)

47 
	#AOA_ACCESSORY_ADB_PID
 0x2D01

	)

48 
	#AOA_AUDIO_PID
 0x2D02

	)

49 
	#AOA_AUDIO_ADB_PID
 0x2D03

	)

50 
	#AOA_ACCESSORY_AUDIO_PID
 0x2D04

	)

51 
	#AOA_ACCESSORY_AUDIO_ADB_PID
 0x2D05

	)

54 
	#AOA_ACCESSORY_EP_IN
 0x81

	)

55 
	#AOA_ACCESSORY_EP_OUT
 0x02

	)

56 
	#AOA_ACCESSORY_INTERFACE
 0x00

	)

59 
	#PACKAGE_VERSION
 "0.3"

	)

60 
	#PACKAGE_BUGREPORT
 "bissÚ.g¬y@gma.com"

	)

63 vŞ©
¡İ_acc
;

66 
	s_acûssÜy_t
 {

67 
libusb_deviû_hªdË
 *
	mhªdË
;

68 
libusb_Œªsãr
 *
	mŒªsãr
;

69 
ušt32_t
 
	maß_v”siÚ
;

70 
ušt16_t
 
	mvid
;

71 
ušt16_t
 
	mpid
;

72 *
	mdeviû
;

73 *
	mmªuçùu»r
;

74 *
	mmod–
;

75 *
	mdesütiÚ
;

76 *
	mv”siÚ
;

77 *
	mu¾
;

78 *
	m£rŸl
;

79 } 
	tacûssÜy_t
;

	@
1
.
0
13
483
/home/bravo/Projects/Linux/linux-adk/src/accessory.c
/home/bravo/Projects/Linux/linux-adk/src/axis.c
/home/bravo/Projects/Linux/linux-adk/src/axis.h
/home/bravo/Projects/Linux/linux-adk/src/device.c
/home/bravo/Projects/Linux/linux-adk/src/hid.c
/home/bravo/Projects/Linux/linux-adk/src/hid.h
/home/bravo/Projects/Linux/linux-adk/src/hidapi.h
/home/bravo/Projects/Linux/linux-adk/src/linux-adk.c
/home/bravo/Projects/Linux/linux-adk/src/linux-adk.h
axis.h
hid.h
hidapi.h
linux-adk.h
