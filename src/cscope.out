cscope 15 /opt/resource/linux-adk/src -q 0000000313 0000035555
	@/opt/resource/linux-adk/src/accessory.c

21 
	~<¡dio.h
>

22 
	~<¡ršg.h
>

23 
	~<¡dlib.h
>

24 
	~<uni¡d.h
>

25 
	~<¡ršg.h
>

27 
	~<libusb.h
>

29 
	~"lšux-adk.h
"

30 
	~"hid.h
"

32 
	gv®id_mou£_»pÜt_desütÜ
 [] =

89 
	$acûssÜy_maš
(
acûssÜy_t
 * 
acc
)

91 
»t
 = 0;

92 
hid_deviû
 
hid
;

103 ià(
acc
->
pid
 >ğ
AOA_AUDIO_PID
) {

105 
	`´štf
("Device should‚ow be„ecognized‡s valid ALSA card...\n");

106 
	`´štf
(" =>‡record -l\n");

109 if(
	`£¬ch_hid
(&
hid
, 
acc
) == 0) {

110 
	`»gi¡”_hid_ÿÎback
(
acc
, &
hid
);

111 
	`£nd_hid_desütÜ
(
acc
, &
hid
);

117 if(
	`£¬ch_hid
(&
hid
) == 0) {

118 
	`»gi¡”_hid_ÿÎback
(
acc
, &
hid
);

119 
	`£nd_hid_desütÜ
(
acc
, &
hid
);

124 ià((
acc
->
pid
 !ğ
AOA_AUDIO_ADB_PID
è&& (acc->pid !ğ
AOA_AUDIO_PID
)) {

125 
ušt8_t
 
acc_buf
[512];

126 
Œªsã¼ed
, 
i
;

127 
”rÜs
 = 20;

129 
	`´štf
("detach..\n");

130 
	`libusb_£t_auto_d‘ach_k”Ãl_driv”
(
acc
->
hªdË
,1);

133 
	`u¦“p
(10000);

134 
	`´štf
("claiming ...\n");

137 
»t
 =

138 
	`libusb_şaim_š‹rçû
(
acc
->
hªdË
,

139 
AOA_ACCESSORY_INTERFACE
);

140 ià(
»t
 != 0) {

141 
	`´štf
("E¼Ü %d cÏimšg iÁ”çû...\n", 
»t
);

145 
	`´štf
("Snooping†oop\n");

147 
t
 = 0;

149 !
¡İ_acc
) {

150 
	`mem£t
(
acc_buf
,++
t
 % 512,(acc_buf));

152 
»t
 =

153 
	`libusb_bulk_Œªsãr
(
acc
->
hªdË
,

154 
AOA_ACCESSORY_EP_OUT
, 
acc_buf
,

155 (
acc_buf
), &
Œªsã¼ed
,

157 
	`´štf
("EP_OUT„‘(%d)\n",
»t
);

159 
»t
 =

160 
	`libusb_bulk_Œªsãr
(
acc
->
hªdË
,

161 
AOA_ACCESSORY_EP_IN
, 
acc_buf
,

162 (
acc_buf
), &
Œªsã¼ed
,

165 ià(
»t
 < 0) {

166 ià(
»t
 =ğ
LIBUSB_ERROR_TIMEOUT
) {

167 
	`´štf
("timeout...\n");

170 
	`´štf
("bulk¿nsã¸”rÜ %d\n", 
»t
);

171 ià(--
”rÜs
 == 0)

174 
	`¦“p
(1);

179 
	`´štf
("Reûived %d by‹s\n", 
Œªsã¼ed
);

180 
i
 = 0; i < 
Œªsã¼ed
;) {

181 
	`´štf
("%#2.2x ", 
acc_buf
[
i
++]);

182 ià(!(
i
 % 8))

183 
	`´štf
("\n");

185 
	`´štf
("\n");

190 ià((
acc
->
pid
 >ğ
AOA_AUDIO_PID
è&& (
hid
.
hªdË
))

191 
	`±h»ad_još
(
hid
.
rx_th»ad
, 
NULL
);

192 
	}
}

	@/opt/resource/linux-adk/src/axis.c

8 
	~<¡dio.h
>

9 
	~<m©h.h
>

10 
	~<lšux/šput.h
>

11 
	~"axis.h
"

13 
AxisS‘tšg
* 
	g£tup
;

14 
	grÙ
;

15 
	gcos_v®
 = -1;

16 
	gsš_v®
 = -1;

23 
	$axis_š™
(
AxisS‘tšg
* 
as
 , 
ªgË
)

25 if(
as
 =ğ
NULL
 && (
ªgË
 % 90)!= 0) {

28 
£tup
 = 
as
;

29 
rÙ
 = 
ªgË
;

30 
sš_v®
 = 
	`sš
(()(2* 
PI
 * 
ªgË
 / 360));

31 
cos_v®
 = 
	`cos
(()(2* 
PI
 * 
ªgË
 / 360));

44 
	}
}

47 
Pošt
 
	$axis_cÚv”t
(
Pošt
 
p
)

49 
Pošt
 
»t
;

50 
x
,
y
;

52 if((
p
.
x
 - 
£tup
->
css
.
ba£_x
 ) > s‘up->css.
v›w_width
)

53 
p
.
x
 = 
£tup
->
css
.
v›w_width
;

54 if((
p
.
y
 - 
£tup
->
css
.
ba£_y
 ) > s‘up->css.
v›w_height
)

55 
p
.
y
 = 
£tup
->
css
.
v›w_height
;

58 
x
 = 
cos_v®
 * 
p
.x + 
sš_v®
 *….
y
;

59 
y
 = 
cos_v®
 * 
p
.y - 
sš_v®
 *….
x
;

63 
rÙ
) {

66 
y
 = y - 
£tup
->
css
.
ba£_x
 + s‘up->css.
fuÎ_width
;

67 
x
 = x - 
£tup
->
css
.
ba£_y
;

69 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_height
;

70 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_width
;

74 
x
 = x - 
£tup
->
css
.
ba£_y
 + s‘up->css.
fuÎ_height
;

75 
y
 = y - 
£tup
->
css
.
ba£_x
;

77 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_height
;

78 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_width
;

82 
x
 = x - 
£tup
->
css
.
ba£_x
 + s‘up->css.
fuÎ_width
;

83 
y
 = y - 
£tup
->
css
.
ba£_y
 + s‘up->css.
fuÎ_height
;

85 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_width
;

86 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_height
;

90 
x
 = x - 
£tup
->
css
.
ba£_x
;

91 
y
 = y - 
£tup
->
css
.
ba£_y
;

93 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_width
;

94 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_height
;

97 
	`´štf
("unsupported„ot\n");

101 
»t
.
x
 = ()x;

102 
»t
.
y
 = ()y;

103  
»t
;

104 
	}
}

106 
Pošt
 
	$axis_cÚv”t
(
Pošt
 
p
)

108 
Pošt
 
»t
;

109 
»t
.
x
 = -1;

110 
»t
.
y
 = -1;

111 
x1
,
y1
;

112 
x
,
y
;

114 if((
p
.
x
 - 
£tup
->
css
.
ba£_x
 ) > s‘up->css.
v›w_width
)

115  
»t
;

116 if((
p
.
y
 - 
£tup
->
css
.
ba£_y
 ) > s‘up->css.
v›w_height
)

117  
»t
;

120 
x
 = 
p
.x - 
£tup
->
css
.
ba£_x
;

121 
y
 = 
p
.y - 
£tup
->
css
.
ba£_y
;

125 
x1
 = ()(
cos_v®
 * 
x
 + 
sš_v®
 * 
y
);

126 
y1
 = ()(
cos_v®
 * 
y
 - 
sš_v®
 * 
x
);

128 
x
 = 
x1
;

129 
y
 = 
y1
;

132 
rÙ
){

135 
y
 = y + 
£tup
->
css
.
v›w_width
;

136 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_height
;

137 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_width
;

141 
x
 = x + 
£tup
->
css
.
v›w_height
;

142 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_height
;

143 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_width
;

147 
x
 = x + 
£tup
->
css
.
v›w_width
;

148 
y
 = y + 
£tup
->
css
.
v›w_height
;

149 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_width
;

150 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_height
;

154 
x
 = x * 
£tup
->
pss
.
fuÎ_width
 / s‘up->
css
.
v›w_width
;

155 
y
 = y * 
£tup
->
pss
.
fuÎ_height
 / s‘up->
css
.
v›w_height
;

158 
	`´štf
("not supported„ot\n");

162 
»t
.
x
 = ()x;

163 
»t
.
y
 = ()y;

166  
»t
;

167 
	}
}

176 
wr™e_ev’t
(
fd
, 
ty³
, 
code
, 
v®ue
);

177 
EVENT_INFO
 
ei
;

179 
	$axis_šjeù
(
aùiÚ
, 
Pošt
 
p
)

181 
x
 = 
p
.x;

182 
y
 = 
p
.y;

183 
aùiÚ
) {

184 
TOUCH_DOWN
:

196 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_TRACKING_ID
, 0x1b3a);

197 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_KEY
,
BTN_TOUCH
,1);

198 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_ABS
,
ABS_MT_POSITION_X
,
x
);

199 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_ABS
,
ABS_MT_POSITION_Y
,
y
);

200 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_ABS
,
ABS_MT_PRESSURE
,0x3e);

201 
	`wr™e_ev’t
(
ei
.
fd_touch
,0,0,0);

208 
TOUCH_UP
:

213 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_TRACKING_ID
, -1);

214 
	`wr™e_ev’t
(
ei
.
fd_touch
,
EV_KEY
, 
BTN_TOUCH
, 0);

215 
	`wr™e_ev’t
(
ei
.
fd_touch
, 0, 0, 0);

218 
TOUCH_MOVE
:

224 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_POSITION_X
, 
x
);

225 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_POSITION_Y
, 
y
);

226 
	`wr™e_ev’t
(
ei
.
fd_touch
, 
EV_ABS
, 
ABS_MT_PRESSURE
, 0x3d);

227 
	`wr™e_ev’t
(
ei
.
fd_touch
, 0, 0, 0);

231 
	}
}

240 
	$maš
(* 
¬gv
[] ,
¬gc
) {

242 
AxisS‘tšg
 
s
;

244 
s
.
css
.
ba£_x
 = 0;

245 
s
.
css
.
ba£_y
 = 0;

247 
s
.
css
.
v›w_width
 = 1280;

248 
s
.
css
.
v›w_height
 = 800;

250 
s
.
css
.
fuÎ_width
 = 1280;

251 
s
.
css
.
fuÎ_height
 = 800;

253 
s
.
pss
.
fuÎ_width
 = 1200;

254 
s
.
pss
.
fuÎ_height
 = 1600;

255 
Pošt
 
š
,
out
;

257 
s
.
css
.
ba£_x
 = (1280 - 500)/2;

258 
s
.
css
.
ba£_y
 = 0;

259 
s
.
css
.
v›w_width
 = 500;

260 
s
.
css
.
v›w_height
 = 800;

262 
s
.
css
.
fuÎ_width
 = 1280;

263 
s
.
css
.
fuÎ_height
 = 800;

265 
s
.
pss
.
fuÎ_width
 = 800;

266 
s
.
pss
.
fuÎ_height
 = 1280;

267 
Pošt
 
š
,
out
;

269 
Ïng
 = -1;

270 
ªg
 = 90;

272 if(
Ïng
 !ğ
ªg
)

273 
	`axis_š™
(&
s
,
ªg
);

275 
	`´štf
("input (x,y): ");

276 
	`sÿnf
("%d",&
š
.
x
);

277 
	`sÿnf
("%d",&
š
.
y
);

278 
out
 = 
	`axis_cÚv”t
(
š
);

279 
	`´štf
("cÚv”ˆ(%d,%dètØ(%d,%d)\n",
š
.
x
,š.
y
,
out
.x,out.y);

281 
Ïng
 = 
ªg
;

285 
	}
}

	@/opt/resource/linux-adk/src/axis.h

8 #iâdeà
_AXIS_H


9 
	#_AXIS_H


	)

13 
	#PI
 (3.1415926)

	)

16 
	mTOUCH_DOWN
 = 5,

17 
	mTOUCH_MOVE
 = 4,

18 
	mTOUCH_UP
 = 6,

19 } 
	gC¬AùiÚ
;

23 
	mx
;

24 
	my
;

25 } 
	tPošt
;

29 
	mba£_x
;

30 
	mba£_y
;

31 
	mv›w_height
;

32 
	mv›w_width
;

33 
	mfuÎ_height
;

34 
	mfuÎ_width
;

35 } 
	tC¬Sü“nS‘tšg
;

39 
	mfuÎ_height
;

40 
	mfuÎ_width
;

41 } 
	tPhÚeSü“nS‘tšg
;

45 
C¬Sü“nS‘tšg
 
	mcss
;

46 
PhÚeSü“nS‘tšg
 
	mpss
;

47 } 
	tAxisS‘tšg
 ;

55 
axis_š™
(
AxisS‘tšg
* 
as
 , 
ªgË
);

61 
Pošt
 
axis_cÚv”t
(Pošˆ
p
);

68 
axis_šjeù
(
aùiÚ
, 
Pošt
 
p
);

	@/opt/resource/linux-adk/src/device.c

2 
	~<libusb-1.0/libusb.h
>

3 
	~<¡dio.h
>

4 
	~"lšux-adk.h
"

7 
	$·r£_’dpošt
(cÚ¡ 
libusb_’dpošt_desütÜ
 * 
’dpošt
)

9 
	`´štf
(" Endpoint\n");

10 
	`´štf
(" bmA‰ribu‹s: 0x%x\n", 
’dpošt
->
bmA‰ribu‹s
);

11 
	`´štf
(" bEndpoštAdd»ss: 0x%x\n", 
’dpošt
->
bEndpoštAdd»ss
);

13 
	}
}

18 
	$·r£_®t£‰šg
(cÚ¡ 
libusb_š‹rçû_desütÜ
 *
š‹rçû
)

20 
i
;

22 
	`´štf
(" Interface:\n");

23 
	`´štf
(" bIÁ”çûNumb”: %d\n", 
š‹rçû
->
bIÁ”çûNumb”
);

24 
	`´štf
(" bAÉ”Ç‹S‘tšg: %d\n", 
š‹rçû
->
bAÉ”Ç‹S‘tšg
);

25 
	`´štf
(" bNumEndpošts: %d\n", 
š‹rçû
->
bNumEndpošts
);

26 
	`´štf
(" bIÁ”çûCÏss: %d\n", 
š‹rçû
->
bIÁ”çûCÏss
);

27 
	`´štf
(" bIÁ”çûSubCÏss: %d\n", 
š‹rçû
->
bIÁ”çûSubCÏss
);

28 
	`´štf
(" bIÁ”çûPrÙocŞ: %d\n", 
š‹rçû
->
bIÁ”çûPrÙocŞ
);

29 
	`´štf
(" iIÁ”çû: %d\n", 
š‹rçû
->
iIÁ”çû
);

33 ifĞ
š‹rçû
->
bIÁ”çûCÏss
 == 255 &&

34 
š‹rçû
->
bIÁ”çûSubCÏss
 == 66 &&

35 
š‹rçû
->
bIÁ”çûPrÙocŞ
 == 1) {

36 
	`´štf
("Android†ink‡ttached\n");

40 ifĞ
š‹rçû
->
bIÁ”çûCÏss
 == 255 &&

41 
š‹rçû
->
bIÁ”çûSubCÏss
 == 254 &&

42 
š‹rçû
->
bIÁ”çûPrÙocŞ
 == 2) {

45 
i
 = 0; i < 
š‹rçû
->
bNumEndpošts
; i++)

46 
	`·r£_’dpošt
(&
š‹rçû
->
’dpošt
[
i
]);

48 
	}
}

56 
	$·r£_š‹rçû
(cÚ¡ 
libusb_š‹rçû
 *
š‹rçû
)

58 
»t
;

59 
i
;

61 
i
 = 0; i < 
š‹rçû
->
num_®t£‰šg
; i++) {

62 
»t
 = 
	`·r£_®t£‰šg
(&
š‹rçû
->
®t£‰šg
[
i
]);

63 if(
»t
 == 2) „et;

66 
	}
}

73 
	$·r£_cÚfigu¿tiÚ
(
libusb_cÚfig_desütÜ
 *
cÚfig
)

75 
i
;

76 
»t
;

78 
	`´štf
(" Configuration:\n");

79 
	`´štf
(" wTÙ®L’gth: %d\n", 
cÚfig
->
wTÙ®L’gth
);

80 
	`´štf
(" bNumIÁ”çûs: %d\n", 
cÚfig
->
bNumIÁ”çûs
);

81 
	`´štf
(" bCÚfigu¿tiÚV®ue: %d\n", 
cÚfig
->
bCÚfigu¿tiÚV®ue
);

82 
	`´štf
(" iCÚfigu¿tiÚ: %d\n", 
cÚfig
->
iCÚfigu¿tiÚ
);

83 
	`´štf
(" bmA‰ribu‹s: %02xh\n", 
cÚfig
->
bmA‰ribu‹s
);

84 
	`´štf
(" MaxPow”: %d\n", 
cÚfig
->
MaxPow”
);

87 
i
 = 0; i < 
cÚfig
->
bNumIÁ”çûs
; i++) {

88 
»t
 = 
	`·r£_š‹rçû
(&
cÚfig
->
š‹rçû
[
i
]);

89 if(
»t
 == 2) „et;

93 
	}
}

100 
	$·r£_devs
(
vid
)

102 
libusb_deviû
 **
devs
;

103 
libusb_deviû_desütÜ
 
desc
;

104 
libusb_cÚfig_desütÜ
 *
cÚfig
;

105 
ssize_t
 
út
;

106 
»t
, 
i
;

108 
»t
 = 
	`libusb_š™
(
NULL
);

109 ià(
»t
 < 0)

110  
»t
;

112 
út
 = 
	`libusb_g‘_deviû_li¡
(
NULL
, &
devs
);

113 ià(
út
 < 0)

114  ()
út
;

116 
i
 = 0; 
devs
[i]; ++i) {

118 
»t
 = 
	`libusb_g‘_deviû_desütÜ
(
devs
[
i
], &
desc
);

119 ià(
»t
 < 0) {

120 
	`´štf
( "failedo get device descriptori\n");

124 
	`´štf
("deviû‡‰ached: %04x:%04x\n", 
desc
.
idV’dÜ
, desc.
idProduù
);

125 if(
vid
 =ğ0 || 
desc
.
idV’dÜ
 == vid ) {

126 
	`´štf
("vid(0x%xè©ched \n",
desc
.
idV’dÜ
);

127 
»t
 = 
	`libusb_g‘_aùive_cÚfig_desütÜ
(
devs
[
i
], &
cÚfig
);

128 ià(
»t
 !ğ
LIBUSB_SUCCESS
) {

129 
	`´štf
("Failed†ibusb_get_active_config_descriptor\n");

130 
»t
 = -1;

131 
EXIT
;

133 
»t
 = 
	`·r£_cÚfigu¿tiÚ
(
cÚfig
);

137 
EXIT
:

138 
	`libusb_ä“_deviû_li¡
(
devs
, 1);

139  
»t
;

140 
	}
}

148 
	$İ’_¥ecŸl_vid_dev
(
vid
, 
acûssÜy_t
 * 
acc
)

150 
libusb_deviû
 **
devs
;

151 
libusb_deviû_hªdË
 *
hªdË
;

152 
libusb_deviû_desütÜ
 
desc
;

153 
libusb_cÚfig_desütÜ
 *
cÚfig
;

154 
ssize_t
 
út
;

155 
»t
, 
i
;

161 
út
 = 
	`libusb_g‘_deviû_li¡
(
NULL
, &
devs
);

162 ià(
út
 < 0)

163  ()
út
;

165 
i
 = 0; 
devs
[i]; ++i) {

167 
»t
 = 
	`libusb_g‘_deviû_desütÜ
(
devs
[
i
], &
desc
);

168 ià(
»t
 < 0) {

169 
	`´štf
( "failedo get device descriptori\n");

173 
	`´štf
("deviû‡‰ached: %04x:%04x\n", 
desc
.
idV’dÜ
, desc.
idProduù
);

174 if(
desc
.
idV’dÜ
 =ğ
vid
 ) {

175 
	`´štf
("vid(0x%xè©ched \n",
desc
.
idV’dÜ
);

176 
»t
 = 
	`libusb_g‘_aùive_cÚfig_desütÜ
(
devs
[
i
], &
cÚfig
);

177 ià(
»t
 !ğ
LIBUSB_SUCCESS
) {

178 
	`´štf
("Failed†ibusb_get_active_config_descriptor\n");

179 
»t
 = -1;

180 
EXIT
;

182 
»t
 = 
	`·r£_cÚfigu¿tiÚ
(
cÚfig
);

184 
	`libusb_»f_deviû
(
devs
[
i
]);

185 
»t
 = 
	`libusb_İ’
(
devs
[
i
],&
hªdË
);

186 ià(
»t
 !ğ
LIBUSB_SUCCESS
) {

187 
	`´štf
Ğ"Faed†ibusb_İ’(%d)\n",
»t
);

188 
»t
 = -1;

189 
EXIT
;

191 
acc
->
hªdË
 = handle;

192 
	`´štf
( "OK†ibusb_open get handle\n");

198 
EXIT
:

199 
	`libusb_ä“_deviû_li¡
(
devs
, 1);

200  
»t
;

201 
	}
}

	@/opt/resource/linux-adk/src/hid.c

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

25 
	~<¡dlib.h
>

26 
	~<¡dšt.h
>

27 
	~<uni¡d.h
>

28 
	~<pŞl.h
>

29 
	~<libusb.h
>

31 
	~"lšux-adk.h
"

32 
	~"hid.h
"

33 
	~"axis.h
"

35 
	#REPORT_ID
 (4)

	)

36 
	#TOUCHSCREEN_ENABLE
 (1)

	)

38 #if(
TOUCHSCREEN_ENABLE
 == 1)

39 cÚ¡ 
	ghid_»pÜt_desc
[] = {

45 0x85, 
REPORT_ID
,

85 
	sR•Üt
 {

86 
	m»pÜt_id
 ;

88 
	mbTSw™ch
 : 1;

89 
	mbInRªge
 : 1;

90 
	m»£rved
 : 6;

91 } 
	m¡©us
;

92 
	mwXD©a
;

93 
	mwYD©a
;

97 *
	$»ûive_loİ
(*
¬g
)

99 !
¡İ_acc
) {

100 
»t
 = 0;

101 
i
;

102 
nfds
 = 1;

103 
timev®
 
tv
, 
z”o_tv
;

104 cÚ¡ 
libusb_pŞlfd
 **
pŞl_li¡
;

105 
fd_£t
 
rfds
, 
wfds
, 
efds
;

106 
tv
.
tv_£c
 = 0;

107 
tv
.
tv_u£c
 = 0;

108 
z”o_tv
.
tv_£c
 = 0;

109 
z”o_tv
.
tv_u£c
 = 0;

111 
»t
 = 
	`libusb_g‘_Ãxt_timeout
(
NULL
, &
tv
);

112 ià(
»t
 < 0) {

113 ià(
»t
)

114 
	`´štf
("USBƒrror : %s\n",

115 
	`libusb_”rÜ_Çme
(
»t
));

119 ià(
»t
 =ğ1 && 
tv
.
tv_£c
 =ğ0 &&v.
tv_u£c
 == 0) {

120 
»t
 = 
	`libusb_hªdË_ev’ts_timeout_com¶‘ed
(
NULL
,

121 &
z”o_tv
,

122 
NULL
);

123 ià(
»t
) {

124 ià(
»t
)

125 
	`´štf
("USBƒrror : %s\n",

126 
	`libusb_”rÜ_Çme
(
»t
));

132 
	`FD_ZERO
(&
rfds
);

133 
	`FD_ZERO
(&
wfds
);

134 
	`FD_ZERO
(&
efds
);

135 
	`FD_SET
(0, &
rfds
);

136 
pŞl_li¡
 = 
	`libusb_g‘_pŞlfds
(
NULL
);

137 ià(
pŞl_li¡
) {

138 
i
 = 0; 
pŞl_li¡
[i] !ğ
NULL
; i++) {

139 cÚ¡ 
libusb_pŞlfd
 *
cur_pŞl
;

141 
cur_pŞl
 = 
pŞl_li¡
[
i
];

142 
nfds
 = 
cur_pŞl
->
fd
 >=‚fds

143 ? 
cur_pŞl
->
fd
 + 1 : 
nfds
;

144 ià(
cur_pŞl
->
ev’ts
 & 
POLLIN
)

145 
	`FD_SET
(
cur_pŞl
->
fd
, &
rfds
);

146 ià(
cur_pŞl
->
ev’ts
 & 
POLLOUT
)

147 
	`FD_SET
(
cur_pŞl
->
fd
, &
wfds
);

149 
	`ä“
(
pŞl_li¡
);

153 ià(
tv
.
tv_£c
 =ğ0 &&v.
tv_u£c
 == 0)

154 
»t
 = 
	`£Ëù
(
nfds
, &
rfds
, &
wfds
, &
efds
, 
NULL
);

156 
»t
 = 
	`£Ëù
(
nfds
, &
rfds
, &
wfds
, &
efds
, &
tv
);

158 ià(
libusb_hªdË_ev’ts_timeout_com¶‘ed


159 (
NULL
, &
z”o_tv
, NULL))

163  
NULL
;

164 
	}
}

166 
	$İ’_deviû
(
libusb_deviû_hªdË
 **
hªdË
,

167 
libusb_deviû
 * 
deviû
, 
š‹rçû
)

169 
k”Ãl_şaimed
 = 0, 
»t
;

171 
	`libusb_»f_deviû
(
deviû
);

172 
»t
 = 
	`libusb_İ’
(
deviû
, 
hªdË
);

173 ià(
»t
) {

174 
	`´štf
("UÇbËØİ’ usb deviû [%#08x]\n", 
»t
);

175 *
hªdË
 = 
NULL
;

179 
	`´štf
("libusb_kernel_driver_active\n");

180 
»t
 = 
	`libusb_k”Ãl_driv”_aùive
(*
hªdË
, 
š‹rçû
);

181 ià(
»t
 == 1) {

182 ià(
	`libusb_d‘ach_k”Ãl_driv”
(*
hªdË
, 
š‹rçû
)) {

183 
	`´štf
("Unableo grab usb device\n");

184 
	`libusb_şo£
(*
hªdË
);

185 *
hªdË
 = 
NULL
;

188 
k”Ãl_şaimed
 = 1;

191 
	`´štf
("libusb_claim_interface\n");

192 
»t
 = 
	`libusb_şaim_š‹rçû
(*
hªdË
, 
š‹rçû
);

193 ià(
»t
) {

194 
	`´štf
("FaedØşaim iÁ”çû %d.\n", 
š‹rçû
);

195 ià(
k”Ãl_şaimed
) {

196 
	`libusb_©ch_k”Ãl_driv”
(*
hªdË
, 
š‹rçû
);

197 
k”Ãl_şaimed
 = 0;

199 
	`libusb_şo£
(*
hªdË
);

200 *
hªdË
 = 
NULL
;

205 
	}
}

207 
	$ÿÎback_hid
(
libusb_Œªsãr
 *
Œªsãr
)

209 
acûssÜy_t
 *
acc
 = 
Œªsãr
->
u£r_d©a
;

210 
rc
 = 0;

212 ià(
Œªsãr
->
¡©us
 =ğ
LIBUSB_TRANSFER_COMPLETED
) {

213 
libusb_Œªsãr
 *
ªdroid_Œªsãr
;

214 *
keybuf
;

215 
rc
;

217 
ªdroid_Œªsãr
 = 
	`libusb_®loc_Œªsãr
(0);

220 #if(
TOUCHSCREEN_ENABLE
 == 1)

221 
Œªsãr
->
aùu®_Ëngth
 = (
R•Üt
);

226 
couÁs
 = 0;

228 
R•Üt
 
»pÜt
;

229 
»pÜt
.
»pÜt_id
 = 
REPORT_ID
;

230 if(
couÁs
 != 0) {

231 
»pÜt
.
wXD©a
 = 
couÁs
 % 1080;

232 
»pÜt
.
wYD©a
 = 
couÁs
 * 1920 / 1080 % 1920 ;

234 
»pÜt
.
wXD©a
 =„•Üt.
wYD©a
 = 0;

236 if(
»pÜt
.
wXD©a
 >= 200 &&„eport.wXData <= 900)

237 
»pÜt
.
¡©us
.
bTSw™ch
 = 1;

239 
»pÜt
.
¡©us
.
bTSw™ch
 = 0;

240 
couÁs
 ++;

241 
Œªsãr
->
bufãr
 = (*)&
»pÜt
;

243 
keybuf
 = 
	`m®loc
(
Œªsãr
->
aùu®_Ëngth
 + 
LIBUSB_CONTROL_SETUP_SIZE
);

244 
	`memıy
(
keybuf
 + 
LIBUSB_CONTROL_SETUP_SIZE
, 
Œªsãr
->
bufãr
,

245 
Œªsãr
->
aùu®_Ëngth
);

247 
	`´štf
("hid„eport data:\n");

248 
s
 = 0;

249 
s
 = 0 ; s < 
Œªsãr
->
aùu®_Ëngth
; s ++) {

250 
	`´štf
("0x%02x ",
Œªsãr
->
bufãr
[
s
]);

252 
	`´štf
("\n");

255 
	`libusb_fl_cÚŒŞ_£tup
(
keybuf
,

256 
LIBUSB_ENDPOINT_OUT
 |

257 
LIBUSB_REQUEST_TYPE_VENDOR
,

258 
AOA_SEND_HID_EVENT
, 1, 0,

259 
Œªsãr
->
aùu®_Ëngth
);

261 
	`libusb_fl_cÚŒŞ_Œªsãr
(
ªdroid_Œªsãr
, 
acc
->
hªdË
,

262 
keybuf
, 
NULL
, NULL, 0);

264 
ªdroid_Œªsãr
->
æags
 =

265 
LIBUSB_TRANSFER_FREE_BUFFER
 | 
LIBUSB_TRANSFER_FREE_TRANSFER
;

267 
rc
 = 
	`libusb_subm™_Œªsãr
(
ªdroid_Œªsãr
);

268 ià(
rc
)

269 
	`´štf
("USBƒ¼Ü : %s\n", 
	`libusb_”rÜ_Çme
(
rc
));

271 
rc
 = 
	`libusb_subm™_Œªsãr
(
Œªsãr
);

272 ià(
rc
)

273 
	`´štf
("USBƒ¼Ü : %s\n", 
	`libusb_”rÜ_Çme
(
rc
));

275 } ià(
Œªsãr
->
¡©us
 =ğ
LIBUSB_TRANSFER_TIMED_OUT
) {

276 
rc
 = 
	`libusb_subm™_Œªsãr
(
Œªsãr
);

277 ià(
rc
)

278 
	`´štf
("USBƒ¼Ü : %s\n", 
	`libusb_”rÜ_Çme
(
rc
));

280 
	}
}

282 
	$£¬ch_hid
(
hid_deviû
 * 
hid
)

284 
libusb_deviû
 **
li¡
;

285 
libusb_deviû_desütÜ
 
desc
;

286 
ssize_t
 
út
;

287 
ssize_t
 
i
 = 0;

288 
j
;

289 
libusb_deviû
 *
deviû
;

291 
hid
->
hªdË
 = 
NULL
;

294 
út
 = 
	`libusb_g‘_deviû_li¡
(
NULL
, &
li¡
);

295 ià(
út
 < 0)

296 
”rÜ0
;

298 
i
 = 0; i < 
út
; i++) {

299 
deviû
 = 
li¡
[
i
];

300 
r
;

302 
	`´štf
("út(%dèi(%dè\n",
út
,
i
);

304 
r
 = 
	`libusb_g‘_deviû_desütÜ
(
deviû
, &
desc
);

305 ià(
r
 < 0)

308 
	`´štf
("desc.bDeviûCÏs ğ%d\n",
desc
.
bDeviûCÏss
);

309 ià(
desc
.
bDeviûCÏss
 =ğ
LIBUSB_CLASS_HID
) {

310 
found
;

312 } ià(
desc
.
bDeviûCÏss
 =ğ
LIBUSB_CLASS_PER_INTERFACE
) {

313 
libusb_cÚfig_desütÜ
 *
cu¼’t_cÚfig
;

314 
r
;

316 
	`´štf
("libusb_get_active_config_descriptor\n");

317 
r
 = 
	`libusb_g‘_aùive_cÚfig_desütÜ
(
deviû
,

318 &
cu¼’t_cÚfig
);

319 ià(
r
 < 0) {

320 
	`´štf
("g‘‡ùivdesø”rÜ(%d)",
r
);

323 
	`´štf
("parse hid cfg interface\n");

327 
	`´štf
("bNumIÁ”çûs(%d)\n",
cu¼’t_cÚfig
->
bNumIÁ”çûs
);

329 
j
 = 0; j < 
cu¼’t_cÚfig
->
bNumIÁ”çûs
; j++) {

330 
k
;

331 
	`´štf
("num_®t£‰šg(%d)\n",
cu¼’t_cÚfig
->
š‹rçû
[
j
].
num_®t£‰šg
);

332 
k
 = 0;

333 
k
 <

334 
cu¼’t_cÚfig
->

335 
š‹rçû
[
j
].
num_®t£‰šg
; 
k
++) {

336 ià(
cu¼’t_cÚfig
->

337 
š‹rçû
[
j
].
®t£‰šg
[
k
].

338 
bIÁ”çûCÏss
 ==

339 
LIBUSB_CLASS_HID
) {

340 
hid
->
’dpošt_š
 =

341 
cu¼’t_cÚfig
->
š‹rçû


342 [
j
].

343 
®t£‰šg
[
k
].
’dpošt


344 [0].
bEndpoštAdd»ss
;

345 
hid
->
·ck‘_size
 =

346 
cu¼’t_cÚfig
->
š‹rçû


347 [
j
].

348 
®t£‰šg
[
k
].
’dpošt
[0].

349 
wMaxPack‘Size
;

350 
	`´štf
("£ˆ’dpošt(0x%x)\n",
hid
->
’dpošt_š
);

351 
found
;

355 
	`´štf
("libusb_free_config_descriptor\n");

356 
	`libusb_ä“_cÚfig_desütÜ
(
cu¼’t_cÚfig
);

360 
	`´štf
("found ...\n");

361 
found
:

362 ià(
i
 =ğ
út
)

363 
”rÜ0
;

365 
	`´štf
("open_device...\n");

366 ià(
	`İ’_deviû
(&
hid
->
hªdË
, 
deviû
, 
j
) < 0)

367 
”rÜ0
;

370 
	`´štf
("GET_DESCRIPTOR...\n");

371 
hid
->
desütÜ_size
 = 
	`libusb_cÚŒŞ_Œªsãr
(hid->
hªdË
,

372 
LIBUSB_ENDPOINT_IN
 |

373 
LIBUSB_RECIPIENT_INTERFACE
,

374 
LIBUSB_REQUEST_GET_DESCRIPTOR
,

375 
LIBUSB_DT_REPORT
 << 8, 0,

376 
hid
->
desütÜ
, 256, 0);

377 ià(
hid
->
desütÜ_size
 < 0)

378 
”rÜ1
;

380 
	`libusb_ä“_deviû_li¡
(
li¡
, 1);

381 
	`´štf
("=> found HID deviû vid 0x%x…id 0x%x\n", 
desc
.
idV’dÜ
,

382 
desc
.
idProduù
);

383 
s
 = 0;

384 
	`´štf
("descriptor: \n");

385 
s
 = 0 ; s < 
hid
->
desütÜ_size
; s ++) {

386 
	`´štf
("0x%02x ",
hid
->
desütÜ
[
s
]);

388 
	`´štf
("\n");

391 
”rÜ1
:

392 
	`libusb_şo£
(
hid
->
hªdË
);

393 
”rÜ0
:

394 
	`libusb_ä“_deviû_li¡
(
li¡
, 1);

396 
	}
}

398 
	$»gi¡”_hid_ÿÎback
(
acûssÜy_t
 * 
acc
, 
hid_deviû
 * 
hid
)

400 
libusb_Œªsãr
 *
hid_Œªsãr
;

401 *
keybuf
;

402 
rc
;

404 
AxisS‘tšg
 
£t
;

405 
£t
.
css
.
ba£_x
 = 0 ;

406 
£t
.
css
.
ba£_y
 = 0 ;

407 
£t
.
css
.
v›w_width
= 0 ;

408 
£t
.
css
.
v›w_height
 = s‘.css.
fuÎ_height
 = 1920 ;

409 
£t
.
css
.
v›w_width
 = s‘.css.
fuÎ_width
 = 1080 ;

411 
£t
.
pss
.
fuÎ_width
 = 1080;

412 
£t
.
pss
.
fuÎ_height
 = 1920;

414 
	`axis_š™
(&
£t
,0);

416 
keybuf
 = 
	`m®loc
(
hid
->
·ck‘_size
);

418 
hid_Œªsãr
 = 
	`libusb_®loc_Œªsãr
(0);

419 ià(
hid_Œªsãr
 =ğ
NULL
) {

420 
	`libusb_şo£
(
hid
->
hªdË
);

424 
	`libusb_fl_š‹¼u±_Œªsãr
(
hid_Œªsãr
, 
hid
->
hªdË
,

425 
hid
->
’dpošt_š
,

426 
keybuf
, 
hid
->
·ck‘_size
, 
ÿÎback_hid
,

427 
acc
, 0);

429 
rc
 = 
	`libusb_subm™_Œªsãr
(
hid_Œªsãr
);

430 ià(
rc
 != 0) {

431 ià(
rc
)

432 
	`´štf
("USBƒ¼Ü : %s\n", 
	`libusb_”rÜ_Çme
(
rc
));

433 
	`libusb_şo£
(
hid
->
hªdË
);

438 
	}
}

440 
	$£nd_hid_desütÜ
(
acûssÜy_t
 * 
acc
, 
hid_deviû
 * 
hid
)

442 
»t
;

444 
	`´štf
("register hid\n");

445 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
, 
LIBUSB_ENDPOINT_OUT
 |

446 
LIBUSB_REQUEST_TYPE_VENDOR
,

447 #ifdeà
TOUCHSCREEN_ENABLE


448 
AOA_REGISTER_HID
, 1, (
hid_»pÜt_desc
),

450 
AOA_REGISTER_HID
, 1, 
hid
->
desütÜ_size
,

452 
NULL
, 0, 0);

453 ià(
»t
 < 0) {

454 
	`´štf
("couldn't„egister HID device onhe‡ndroid device : %s\n",

455 
	`libusb_”rÜ_Çme
(
»t
));

456 
	`libusb_şo£
(
hid
->
hªdË
);

460 
	`´štf
("send hid„eport\n");

461 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
, 
LIBUSB_ENDPOINT_OUT
 |

462 
LIBUSB_REQUEST_TYPE_VENDOR
,

463 
AOA_SET_HID_REPORT_DESC
, 1, 0,

464 #ifdeà
TOUCHSCREEN_ENABLE


465 
hid_»pÜt_desc
, (hid_report_desc), 0);

467 
hid
->
desütÜ
, hid->
desütÜ_size
, 0);

469 ià(
»t
 < 0) {

470 
	`´štf
("couldn't send HID descriptorohe‡ndroid device\n");

471 
	`libusb_şo£
(
hid
->
hªdË
);

475 
	`±h»ad_ü—‹
(&
hid
->
rx_th»ad
, 
NULL
, 
»ûive_loİ
, NULL);

478 
	}
}

	@/opt/resource/linux-adk/src/hid.h

21 #iâdeà
_HID_H_


22 
	#_HID_H_


	)

24 
	~<±h»ad.h
>

28 
libusb_deviû_hªdË
 *
	mhªdË
;

29 
	mdesütÜ
[256];

30 
	mdesütÜ_size
;

31 
	m’dpošt_š
;

32 
ssize_t
 
	m·ck‘_size
;

33 
±h»ad_t
 
	mrx_th»ad
;

34 } 
	thid_deviû
;

37 
£nd_hid_desütÜ
(
acûssÜy_t
 *
acc
, 
hid_deviû
 *
hid
);

38 
»gi¡”_hid_ÿÎback
(
acûssÜy_t
* 
acc
, 
hid_deviû
 *
hid
);

39 
£¬ch_hid
(
hid_deviû
 *
hid
);

	@/opt/resource/linux-adk/src/linux-adk.c

21 
	~<¡dio.h
>

22 
	~<¡ršg.h
>

23 
	~<¡dlib.h
>

24 
	~<uni¡d.h
>

25 
	~<sigÇl.h
>

27 
	~<libusb.h
>

29 
	~"lšux-adk.h
"

31 
acûssÜy_maš
(
acûssÜy_t
 * 
acc
);

33 vŞ©
	g¡İ_acc
 = 0;

36 
	#V’dÜ_Meizu
 (0x2717)

	)

44 cÚ¡ 
acûssÜy_t
 
	gacc_deçuÉ
 = {

45 .
deviû
 = "2717:0360",

46 .
	gmªuçùu»r
 = "Hello Inc",

47 .
	gmod–
 = "HelloWorldModel",

48 .
	gv”siÚ
 = "2.0",

49 .
	gdesütiÚ
 = "Demo ABS2013",

50 .
	gu¾
 = "https://github.com/gibsson",

51 .
	g£rŸl
 = "0000000012345678",

54 cÚ¡ 
acûssÜy_t
 
	gacc_deçuÉ
 = {

55 .
deviû
 = "2b0e:1764",

56 .
	gmªuçùu»r
 = "leautolinknetworks",

57 .
	gmod–
 = "ecolink",

58 .
	gv”siÚ
 = "2.0",

59 .
	gdesütiÚ
 = "Demo ABS2013",

60 .
	gu¾
 = "https://github.com/gibsson",

61 .
	g£rŸl
 = "0000000012345678",

66 
is_acûssÜy_´e£Á
(
acûssÜy_t
 * 
acc
);

67 
š™_acûssÜy
(
acûssÜy_t
 * 
acc
);

68 
fši_acûssÜy
(
acûssÜy_t
 * 
acc
);

70 
	$show_h–p
(*
Çme
)

72 
´štf


91 "\t-h, --h–p\n\t\tShowhi h–°ªdƒx™.\n", 
Çme
);

93 
	}
}

95 
	$show_v”siÚ
(*
Çme
)

97 
	`´štf
("% v%s\Ä•Üˆbug tØ%s\n", 
Çme
, 
PACKAGE_VERSION
,

98 
PACKAGE_BUGREPORT
);

100 
	}
}

102 
	$sigÇl_hªdËr
(
signo
)

104 
	`´štf
("SIGINT: Closing‡ccessory\n");

105 
¡İ_acc
 = 1;

106 
	}
}

108 
	$maš
(
¬gc
, *
¬gv
[])

110 
¬g_couÁ
 = 1;

111 
no_­p
 = 0;

112 
acûssÜy_t
 
acc
 = { 
NULL
, NULL, 0, 0, 0, NULL, NULL, NULL, NULL, NULL,

113 
NULL
, NULL

116 ià(
	`sigÇl
(
SIGINT
, 
sigÇl_hªdËr
è=ğ
SIG_ERR
)

117 
	`´štf
("Cannot setup‡ signal handler...\n");

120 
¬g_couÁ
 < 
¬gc
) {

121 ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-d") == 0)

122 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--device") == 0)) {

123 
acc
.
deviû
 = 
¬gv
[++
¬g_couÁ
];

124 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-D") == 0)

125 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--description")

127 
acc
.
desütiÚ
 = 
¬gv
[++
¬g_couÁ
];

128 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-m") == 0)

129 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--manufacturer")

131 
acc
.
mªuçùu»r
 = 
¬gv
[++
¬g_couÁ
];

132 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-M") == 0)

133 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--model") == 0)) {

134 
acc
.
mod–
 = 
¬gv
[++
¬g_couÁ
];

135 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-n") == 0)

136 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--versionnumber")

138 
acc
.
v”siÚ
 = 
¬gv
[++
¬g_couÁ
];

139 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-N") == 0)

140 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--no_app") == 0)) {

141 
no_­p
 = 1;

142 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-s") == 0)

143 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--serial") == 0)) {

144 
acc
.
£rŸl
 = 
¬gv
[++
¬g_couÁ
];

145 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-u") == 0)

146 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--url") == 0)) {

147 
acc
.
u¾
 = 
¬gv
[++
¬g_couÁ
];

148 } ià((
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "-v") == 0)

149 || (
	`¡rcmp
(
¬gv
[
¬g_couÁ
], "--version") == 0)) {

150 
	`show_v”siÚ
(
¬gv
[0]);

151 
	`ex™
(1);

153 
	`show_h–p
(
¬gv
[0]);

154 
	`ex™
(1);

156 
¬g_couÁ
++;

160 ià(!
acc
.
deviû
)

161 
acc
.
deviû
 = 
acc_deçuÉ
.device;

162 ià(!
acc
.
desütiÚ
)

163 
acc
.
desütiÚ
 = 
acc_deçuÉ
.description;

164 ià(!
acc
.
mªuçùu»r
 && !
no_­p
)

165 
acc
.
mªuçùu»r
 = 
acc_deçuÉ
.manufacturer;

166 ià(!
acc
.
mod–
 && !
no_­p
)

167 
acc
.
mod–
 = 
acc_deçuÉ
.model;

168 ià(!
acc
.
v”siÚ
)

169 
acc
.
v”siÚ
 = 
acc_deçuÉ
.version;

170 ià(!
acc
.
£rŸl
)

171 
acc
.
£rŸl
 = 
acc_deçuÉ
.serial;

172 ià(!
acc
.
u¾
)

173 
acc
.
u¾
 = 
acc_deçuÉ
.url;

175 ià(
	`š™_acûssÜy
(&
acc
) != 0)

176 
’d
;

178 
	`acûssÜy_maš
(&
acc
);

180 
’d
:

181 
	`fši_acûssÜy
(&
acc
);

183 
	}
}

185 
	$š™_acûssÜy
(
acûssÜy_t
 * 
acc
)

187 
»t
;

188 
ušt16_t
 
pid
, 
vid
;

189 *
tmp
;

190 
ušt8_t
 
bufãr
[2];

191 
Œ›s
 = 1;

194 
»t
 = 
	`libusb_š™
(
NULL
);

195 ià(
»t
 != 0) {

196 
	`´štf
("libusb in™ faed: %d\n", 
»t
);

197  
»t
;

200 
	`·r£_devs
(
vid
);

204 ià(
	`is_acûssÜy_´e£Á
(
acc
))

208 
vid
 = (
ušt16_t
è
	`¡¹Ş
(
acc
->
deviû
, &
tmp
, 16);

209 
pid
 = (
ušt16_t
è
	`¡¹Ş
(
tmp
 + 1, &tmp, 16);

210 
	`´štf
("Lookšg fÜ deviû %4.4x:%4.4x\n", 
vid
, 
pid
);

213 
acc
->
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

214 ià(
acc
->
hªdË
 =ğ
NULL
) {

215 
	`´štf
("Unableo open device...\n");

218 
	`´štf
("O³Àdeviû(%4.4x %4.4xèok\n",
vid
, 
pid
);

221 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

222 
LIBUSB_ENDPOINT_IN
 |

223 
LIBUSB_REQUEST_TYPE_VENDOR
,

224 
AOA_GET_PROTOCOL
, 0, 0, 
bufãr
,

225 (
bufãr
), 0);

226 ià(
»t
 < 0) {

227 
	`´štf
("Error getting…rotocol...\n");

228  
»t
;

230 
acc
->
aß_v”siÚ
 = ((
bufãr
[1] << 8) | buffer[0]);

231 
	`´štf
("Deviû suµÜt AOA %d.0!\n", 
acc
->
aß_v”siÚ
);

235 
	`u¦“p
(10000);

238 ià((
acc
->
aß_v”siÚ
 < 2è&& !acc->
mªuçùu»r
) {

239 
	`´štf
("Connecting without‡n Android App only for AOA 2.0\n");

243 
	`´štf
("Sending identificationohe device\n");

244 ià(
acc
->
mªuçùu»r
) {

245 
	`´štf
(" s’dšg mªuçùu»r: %s\n", 
acc
->
mªuçùu»r
);

246 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

247 
LIBUSB_ENDPOINT_OUT


248 | 
LIBUSB_REQUEST_TYPE_VENDOR
,

249 
AOA_SEND_IDENT
, 0,

250 
AOA_STRING_MAN_ID
,

251 (
ušt8_t
 *è
acc
->
mªuçùu»r
,

252 
	`¡¾’
(
acc
->
mªuçùu»r
) + 1, 0);

253 ià(
»t
 < 0)

254 
”rÜ
;

257 
	`u¦“p
(10000);

258 ià(
acc
->
mod–
) {

259 
	`´štf
(" s’dšg mod–: %s\n", 
acc
->
mod–
);

260 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

261 
LIBUSB_ENDPOINT_OUT


262 | 
LIBUSB_REQUEST_TYPE_VENDOR
,

263 
AOA_SEND_IDENT
, 0,

264 
AOA_STRING_MOD_ID
,

265 (
ušt8_t
 *è
acc
->
mod–
,

266 
	`¡¾’
(
acc
->
mod–
) + 1, 0);

267 ià(
»t
 < 0)

268 
”rÜ
;

273 
	`u¦“p
(10000);

274 
	`´štf
(" s’dšg desütiÚ: %s\n", 
acc
->
desütiÚ
);

275 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

276 
LIBUSB_ENDPOINT_OUT
 |

277 
LIBUSB_REQUEST_TYPE_VENDOR
,

278 
AOA_SEND_IDENT
, 0, 
AOA_STRING_DSC_ID
,

279 (
ušt8_t
 *è
acc
->
desütiÚ
,

280 
	`¡¾’
(
acc
->
desütiÚ
) + 1, 0);

281 ià(
»t
 < 0)

282 
”rÜ
;

284 
	`u¦“p
(10000);

285 
	`´štf
(" s’dšg v”siÚ: %s\n", 
acc
->
v”siÚ
);

286 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

287 
LIBUSB_ENDPOINT_OUT
 |

288 
LIBUSB_REQUEST_TYPE_VENDOR
,

289 
AOA_SEND_IDENT
, 0, 
AOA_STRING_VER_ID
,

290 (
ušt8_t
 *è
acc
->
v”siÚ
,

291 
	`¡¾’
(
acc
->
v”siÚ
) + 1, 0);

292 ià(
»t
 < 0)

293 
”rÜ
;

295 
	`u¦“p
(10000);

296 
	`´štf
(" s’dšg u¾: %s\n", 
acc
->
u¾
);

297 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

298 
LIBUSB_ENDPOINT_OUT
 |

299 
LIBUSB_REQUEST_TYPE_VENDOR
,

300 
AOA_SEND_IDENT
, 0, 
AOA_STRING_URL_ID
,

301 (
ušt8_t
 *è
acc
->
u¾
,

302 
	`¡¾’
(
acc
->
u¾
) + 1, 0);

303 ià(
»t
 < 0)

304 
”rÜ
;

306 
	`u¦“p
(10000);

307 
	`´štf
(" s’dšg s”ŸÈnumb”: %s\n", 
acc
->
£rŸl
);

308 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

309 
LIBUSB_ENDPOINT_OUT
 |

310 
LIBUSB_REQUEST_TYPE_VENDOR
,

311 
AOA_SEND_IDENT
, 0, 
AOA_STRING_SER_ID
,

312 (
ušt8_t
 *è
acc
->
£rŸl
,

313 
	`¡¾’
(
acc
->
£rŸl
) + 1, 0);

314 ià(
»t
 < 0)

315 
”rÜ
;

318 ià(
acc
->
aß_v”siÚ
 >= 2) {

319 
	`´štf
("‡sking for‡udio support\n");

320 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

321 
LIBUSB_ENDPOINT_OUT


322 | 
LIBUSB_REQUEST_TYPE_VENDOR
,

323 
AOA_AUDIO_SUPPORT
, 1, 0, 0, 0, 0);

324 ià(
»t
 < 0)

325 
”rÜ
;

329 
	`u¦“p
(20000);

330 
	`´štf
("Turninghe device in Accessory mode ...");

331 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
acc
->
hªdË
,

332 
LIBUSB_ENDPOINT_OUT
 |

333 
LIBUSB_REQUEST_TYPE_VENDOR
,

334 
AOA_START_ACCESSORY
, 0, 0, 
NULL
, 0, 0);

335 ià(
»t
 < 0) {

336 
	`´štf
("failed\n");

337 
”rÜ
;

341 
	`u¦“p
(20000);

343 
Œ›s
 = 2;

345 
Œ›s
--) {

346 ià(
	`is_acûssÜy_´e£Á
(
acc
))

350 
	`¦“p
(1);

354 
	`İ’_¥ecŸl_vid_dev
(
vid
, 
acûssÜy_t
 * 
acc
);

355 
»t
 = 
	`İ’_¥ecŸl_vid_dev
(
AOA_ACCESSORY_VID
,
acc
);

356 if(
»t
 != 0 ) {

357 
	`´štf
("open_special_vid_dev failed\n");

363 
”rÜ
:

364 
	`´štf
("AcûssÜy in™ faed: %d\n", 
»t
);

366 
	}
}

369 
	$is_acûssÜy_´e£Á
(
acûssÜy_t
 * 
acc
)

371 
	`´štf
("is_accessory_present ..\n");

372 
libusb_deviû_hªdË
 *
hªdË
;

373 
ušt16_t
 
vid
 = 
AOA_ACCESSORY_VID
;

374 
ušt16_t
 
pid
 = 0;

376 
	`´štf
("open AOA_ACCESSORY_PID ...");

378 
pid
 = 
AOA_ACCESSORY_PID
;

379 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

380 ià(
hªdË
 !ğ
NULL
)

381 
şaim
;

384 
pid
 = 
AOA_ACCESSORY_ADB_PID
;

385 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

386 ià(
hªdË
 !ğ
NULL
)

387 
şaim
;

389 
pid
 = 
AOA_AUDIO_PID
;

390 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

391 ià(
hªdË
 !ğ
NULL
)

392 
şaim
;

394 
pid
 = 
AOA_AUDIO_ADB_PID
;

395 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

396 ià(
hªdË
 !ğ
NULL
)

397 
şaim
;

399 
pid
 = 
AOA_ACCESSORY_AUDIO_PID
;

400 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

401 ià(
hªdË
 !ğ
NULL
)

402 
şaim
;

404 
pid
 = 
AOA_ACCESSORY_AUDIO_ADB_PID
;

405 
hªdË
 = 
	`libusb_İ’_deviû_w™h_vid_pid
(
NULL
, 
vid
, 
pid
);

406 ià(
hªdË
 !ğ
NULL
)

407 
şaim
;

409 
	`´štf
("not…resent\n");

412 
şaim
:

413 
	`´štf
("Found‡cûssÜy %4.4x:%4.4x\n", 
vid
, 
pid
);

414 
acc
->
hªdË
 = handle;

415 
acc
->
vid
 = vid;

416 
acc
->
pid
 =…id;

418 
	}
}

420 
	$fši_acûssÜy
(
acûssÜy_t
 * 
acc
)

422 
	`´štf
("Closing USB device\n");

424 ià(
acc
->
hªdË
 !ğ
NULL
) {

425 
	`libusb_»Ëa£_š‹rçû
(
acc
->
hªdË
, 0);

426 
	`libusb_şo£
(
acc
->
hªdË
);

429 
	`libusb_ex™
(
NULL
);

432 
	}
}

	@/opt/resource/linux-adk/src/linux-adk.h

21 #iâdeà
_LINUX_ADK_H_


22 
	#_LINUX_ADK_H_


	)

24 
	~<¡dšt.h
>

27 
	#AOA_GET_PROTOCOL
 51

	)

28 
	#AOA_SEND_IDENT
 52

	)

29 
	#AOA_START_ACCESSORY
 53

	)

30 
	#AOA_REGISTER_HID
 54

	)

31 
	#AOA_UNREGISTER_HID
 55

	)

32 
	#AOA_SET_HID_REPORT_DESC
 56

	)

33 
	#AOA_SEND_HID_EVENT
 57

	)

34 
	#AOA_AUDIO_SUPPORT
 58

	)

37 
	#AOA_STRING_MAN_ID
 0

	)

38 
	#AOA_STRING_MOD_ID
 1

	)

39 
	#AOA_STRING_DSC_ID
 2

	)

40 
	#AOA_STRING_VER_ID
 3

	)

41 
	#AOA_STRING_URL_ID
 4

	)

42 
	#AOA_STRING_SER_ID
 5

	)

45 
	#AOA_ACCESSORY_VID
 0x18D1

	)

46 
	#AOA_ACCESSORY_PID
 0x2D00

	)

47 
	#AOA_ACCESSORY_ADB_PID
 0x2D01

	)

48 
	#AOA_AUDIO_PID
 0x2D02

	)

49 
	#AOA_AUDIO_ADB_PID
 0x2D03

	)

50 
	#AOA_ACCESSORY_AUDIO_PID
 0x2D04

	)

51 
	#AOA_ACCESSORY_AUDIO_ADB_PID
 0x2D05

	)

54 
	#AOA_ACCESSORY_EP_IN
 0x81

	)

55 
	#AOA_ACCESSORY_EP_OUT
 0x02

	)

56 
	#AOA_ACCESSORY_INTERFACE
 0x00

	)

59 
	#PACKAGE_VERSION
 "0.3"

	)

60 
	#PACKAGE_BUGREPORT
 "bissÚ.g¬y@gma.com"

	)

63 vŞ©
¡İ_acc
;

66 
	s_acûssÜy_t
 {

67 
libusb_deviû_hªdË
 *
	mhªdË
;

68 
libusb_Œªsãr
 *
	mŒªsãr
;

69 
ušt32_t
 
	maß_v”siÚ
;

70 
ušt16_t
 
	mvid
;

71 
ušt16_t
 
	mpid
;

72 *
	mdeviû
;

73 *
	mmªuçùu»r
;

74 *
	mmod–
;

75 *
	mdesütiÚ
;

76 *
	mv”siÚ
;

77 *
	mu¾
;

78 *
	m£rŸl
;

79 } 
	tacûssÜy_t
;

	@axis.h

8 #iâdeà
_AXIS_H


9 
	#_AXIS_H


	)

13 
	#PI
 (3.1415926)

	)

16 
	mTOUCH_DOWN
 = 5,

17 
	mTOUCH_MOVE
 = 4,

18 
	mTOUCH_UP
 = 6,

19 } 
	gC¬AùiÚ
;

23 
	mx
;

24 
	my
;

25 } 
	tPošt
;

29 
	mba£_x
;

30 
	mba£_y
;

31 
	mv›w_height
;

32 
	mv›w_width
;

33 
	mfuÎ_height
;

34 
	mfuÎ_width
;

35 } 
	tC¬Sü“nS‘tšg
;

39 
	mfuÎ_height
;

40 
	mfuÎ_width
;

41 } 
	tPhÚeSü“nS‘tšg
;

45 
C¬Sü“nS‘tšg
 
	mcss
;

46 
PhÚeSü“nS‘tšg
 
	mpss
;

47 } 
	tAxisS‘tšg
 ;

55 
axis_š™
(
AxisS‘tšg
* 
as
 , 
ªgË
);

61 
Pošt
 
axis_cÚv”t
(Pošˆ
p
);

68 
axis_šjeù
(
aùiÚ
, 
Pošt
 
p
);

	@hid.h

21 #iâdeà
_HID_H_


22 
	#_HID_H_


	)

24 
	~<±h»ad.h
>

28 
libusb_deviû_hªdË
 *
	mhªdË
;

29 
	mdesütÜ
[256];

30 
	mdesütÜ_size
;

31 
	m’dpošt_š
;

32 
ssize_t
 
	m·ck‘_size
;

33 
±h»ad_t
 
	mrx_th»ad
;

34 } 
	thid_deviû
;

37 
£nd_hid_desütÜ
(
acûssÜy_t
 *
acc
, 
hid_deviû
 *
hid
);

38 
»gi¡”_hid_ÿÎback
(
acûssÜy_t
* 
acc
, 
hid_deviû
 *
hid
);

39 
£¬ch_hid
(
hid_deviû
 *
hid
);

	@linux-adk.h

21 #iâdeà
_LINUX_ADK_H_


22 
	#_LINUX_ADK_H_


	)

24 
	~<¡dšt.h
>

27 
	#AOA_GET_PROTOCOL
 51

	)

28 
	#AOA_SEND_IDENT
 52

	)

29 
	#AOA_START_ACCESSORY
 53

	)

30 
	#AOA_REGISTER_HID
 54

	)

31 
	#AOA_UNREGISTER_HID
 55

	)

32 
	#AOA_SET_HID_REPORT_DESC
 56

	)

33 
	#AOA_SEND_HID_EVENT
 57

	)

34 
	#AOA_AUDIO_SUPPORT
 58

	)

37 
	#AOA_STRING_MAN_ID
 0

	)

38 
	#AOA_STRING_MOD_ID
 1

	)

39 
	#AOA_STRING_DSC_ID
 2

	)

40 
	#AOA_STRING_VER_ID
 3

	)

41 
	#AOA_STRING_URL_ID
 4

	)

42 
	#AOA_STRING_SER_ID
 5

	)

45 
	#AOA_ACCESSORY_VID
 0x18D1

	)

46 
	#AOA_ACCESSORY_PID
 0x2D00

	)

47 
	#AOA_ACCESSORY_ADB_PID
 0x2D01

	)

48 
	#AOA_AUDIO_PID
 0x2D02

	)

49 
	#AOA_AUDIO_ADB_PID
 0x2D03

	)

50 
	#AOA_ACCESSORY_AUDIO_PID
 0x2D04

	)

51 
	#AOA_ACCESSORY_AUDIO_ADB_PID
 0x2D05

	)

54 
	#AOA_ACCESSORY_EP_IN
 0x81

	)

55 
	#AOA_ACCESSORY_EP_OUT
 0x02

	)

56 
	#AOA_ACCESSORY_INTERFACE
 0x00

	)

59 
	#PACKAGE_VERSION
 "0.3"

	)

60 
	#PACKAGE_BUGREPORT
 "bissÚ.g¬y@gma.com"

	)

63 vŞ©
¡İ_acc
;

66 
	s_acûssÜy_t
 {

67 
libusb_deviû_hªdË
 *
	mhªdË
;

68 
libusb_Œªsãr
 *
	mŒªsãr
;

69 
ušt32_t
 
	maß_v”siÚ
;

70 
ušt16_t
 
	mvid
;

71 
ušt16_t
 
	mpid
;

72 *
	mdeviû
;

73 *
	mmªuçùu»r
;

74 *
	mmod–
;

75 *
	mdesütiÚ
;

76 *
	mv”siÚ
;

77 *
	mu¾
;

78 *
	m£rŸl
;

79 } 
	tacûssÜy_t
;

	@
1
.
0
11
320
/opt/resource/linux-adk/src/accessory.c
/opt/resource/linux-adk/src/axis.c
/opt/resource/linux-adk/src/axis.h
/opt/resource/linux-adk/src/device.c
/opt/resource/linux-adk/src/hid.c
/opt/resource/linux-adk/src/hid.h
/opt/resource/linux-adk/src/linux-adk.c
/opt/resource/linux-adk/src/linux-adk.h
axis.h
hid.h
linux-adk.h
